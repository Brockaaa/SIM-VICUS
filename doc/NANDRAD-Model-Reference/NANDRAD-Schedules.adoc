:imagesdir: ./images
[[schedules]]
# Schedules

## Overview

Schedules provide purely time-dependent quantities, similar to climatic loads. Different to other results-producing models, schedules generate variables for sets of dependent models. As such, a schedule is formulated for an object list, which selects a set of objects taking the values provided by the schedule.
For example they are used in the following objects or list of objects:

* **Occupancy rates**, **heat loads**, *clothing factors* in the person load model.
* *Heating/cooling set point temperatures* for thermostat controls
* *Mass flow rates* or temperature set points for plant components
* *electrical power rates* for lighting and electrical devices

For example, a schedule defines heating set points `HeatingSetPoint` for specific zones like living rooms. These are selected by an object list named "Living room", which selects objects with the type `Zone` and a certain ID range. Later you will find more about this in more detail.

Within the project file there are two possible ways to describe a schedule: 

* `ScheduleGroups` 
* `AnnualSchedules`. 

The two options are discussed in <<regularSchedules>> and <<annualSchedules>>. 

Furthermore `Schedules` consist of two different types of data handling:

* *Cyclic* data
* *Non-cyclic* data

*Cyclic data* means that schedule values will be repeated after the end of the schedule period. This means for example that an annual schedule will be run twice if the simulation time will be set to two years. *Cyclic-data* can be defined by * `ScheduleGroups` and `AnnualSchedules`.

Whereas *non-cyclic* data will always be used only once. This is useful if monitored data will be used to set up schedules. Then the simulation needs to be set only for the time span the monitored data is existing. *Non-cyclic* data can only be defined by `AnnualSchedules`

[[regularSchedules]]
## Regular schedules

:xrefstyle: short 

Regular schedules are defined upon a daily cycle based scheme. 

[[ex_ScheduleGroup]]
.ScheduleGroup Definition
====
[source,xml,indent=0]
----
<ScheduleGroup objectList="Zone">
    <Holidays>100,101,102</Holidays>
	<!-- AllDays constant  -->
	<Schedule type="AllDays">
		<DailyCycles>
			<DailyCycle interpolation="Constant">
				<TimePoints>0</TimePoints>
				<Values>InfiltrationRateSchedule [1/h]:0</Values>
			</DailyCycle>
		</DailyCycles>
	</Schedule>
	<Schedule type="WeekDays">
		<DailyCycles>
			<DailyCycle interpolation="Constant">
				<TimePoints>0 7 18 24</TimePoints>
				<Values>InfiltrationRateSchedule [1/h]:0 1 1 0</Values>
			</DailyCycle>
		</DailyCycles>
	</Schedule>
</ScheduleGroup>
----

====

.ObjectList with an Zone linked
====
[source,xml,indent=0]
----
<ObjectLists>
	<ObjectList name="Zone">
		<FilterID>*</FilterID>
		<ReferenceType>Zone</ReferenceType>
	</ObjectList>
</ObjectLists>
----

====

Regular schedules are defined within the XML tag `ScheduleGroup` with an XML attribute named `objectList` that references an `ObjectList` with the specified name (see <<tab_ScheduleGroup>>). Inside the object an XML tag named `Schedule` needs to be defined with an XML attribute `type`. This `type` can have several names for different days (see <<tab_ScheduleTypes>>). As shown, a priority list exists that defines on how to define a yearly schedule based on a daily cycle.

### Daily cycles

At first priority the type `Alldays` will set a specified daily values to all days of the whole year (Priority 0). After this the `type` named `WeekEnd` and `WeekDay` will overwrite the already defined values for only all week days or weekend days (Priority 1). Furthermore the weekdays named `Monday`, `Tuesday`, etc define for which days the values will be overwritten again (Priority 2). This continues with the `type` `Holiday` (Priority 3). So that in the end a final schedule for the whole year can be defined. 

:xrefstyle: basic 

[[tab_ScheduleGroup]]
.Attribute for the ScheduleGroup
[options="header",cols="15%,65%,^ 10%,^ 10%",width="100%"]
|====================
|Name|Description| Format |Usage
| `objectList` |  References to an object list with the specifed name | string | _required_
|====================

[[tab_ScheduleTypes]]
.Description of schedule type attribute
[options="header"]
[cols="< 15, ^ 10, < 70"]
[width="100%"]
|====================
| `type` | Priority | Description
| `AllDays`
| 0 | Values will be set to all days of the period
| `WeekEnd` {set:cellbgcolor: #F4F4F4  } 
| 1 | Values will be set to all weekend days of the period
| `WeekDay` | 1 | Values will be set to all week days of the period
| `Monday` {set:cellbgcolor: transparent }  
| 2 | Values will be set to all Mondays of the period
| `Tuesday` | 2 | Values will be set to all Tuesdays of the period
| `Wednesday` | 2 | Values will be set to all Wednesdays of the period
| `Thursday` | 2 | Values will be set to all Thursdays of the period
| `Friday` | 2 | Values will be set to all Fridays of the period
| `Saturday` | 2 | Values will be set to all Saturdays of the period
| `Sunday` | 2 | Values will be set to all Sundays of the period
| `Holiday` {set:cellbgcolor: #F4F4F4 } 
| 3 | Values will be set to all holidays of the period that are specified inside the `holidays` tag
|====================

.Defined schedule for `Mondays`
image::alldays.png[width=80%, scalewidth=12cm]

.Defined schedule for `Mondays`
image::mondays.png[width=80%, scalewidth=12cm]

.Defined schedule for `Weekdays` for the period of January
image::weekdays.png[width=80%, scalewidth=12cm]

.Resulting Schedule shown for a week in January 
image::week.png[width=80%, scalewidth=12cm]

.Resulting Schedule shown for January and February
image::year.png[width=80%, scalewidth=12cm]


[[annualSchedules]]
## Annual schedules 

Annual schedules are basically data tables with monotonically increasing X an Y-Values. Annual schedules can be defined as any linear/constant interpolated data tables. For example, hourly values of temperatures or control variables measured during the year can be specified. 

Inside the XML tag `AnnualSchedules` the sub tag `SpaceTypeGroup` with an XML attribute `spaceTypeName` needs to be defined. This defined attribute needs to match to an defined `SpaceType` with the same name. 

[[ex_AnnualSchedule]]
.Definition of an Annual Schedule
====
[source,xml,indent=0]
----

<AnnualSchedules>
    ...
	<SpaceTypeGroup spaceTypeName="Zone">
    	<IBK:LinearSpline name="HeatingSetPointTemperature" interpolation="linear">
    		<X unit="h">0	2183	2184	6576	6577	8760</X>
    		<Y unit="C">20	30		20		30		20		30</Y>
    	</IBK:LinearSpline>	
    	<IBK:LinearSpline name="TotalEnergyProductionPerPerson" interpolation="linear">
    		<X unit="h">		0	2183	2184	6576	6577	8760</X>
    		<Y unit="W/Person">	70	110		70		110		70		110</Y>
    	</IBK:LinearSpline>
    	<IBK:LinearSpline name="EquipmentUtilizationRatio" interpolation="linear">
    		<X unit="h">		0	2183	2184	6576	6577	8760</X>
    		<Y unit="W/Person">	10	20		10		20		10		20</Y>
    	</IBK:LinearSpline>
    </SpaceTypeGroup>
    ...
</AnnualSchedules>

----
====

.Paramaters that can be set for the IBK:LinearSpline
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
|Attribute {set:cellbgcolor:transparent} |Description|Format|Usage
| `name` | Specific name that references to the space type the annual schedule will be set for | string | _required_
| `InterpolationMethod` 
a| Specifies the interpolation method between the defined y values.

* `constant` - constant interpolation (values constant during time step) 
* `linear` - linear interpolation (values linear interpolated between time steps)  

| key | _required_
a|

[WARNING]
====
`WrapMethod`

not yet implemented
====

a| Specifies how to treat the values in multi-year simulations 

* `cyclic` - Annual cyclic data
* `continuous` - Continuous data without repetition

| key | _required_

|====================

#### Time/day mapping in cyclic annual schedules

For cyclic schedule data, the flag "Cyclic" must be set in Schedules xml-block.

The following conventions apply:

- start year by default is 2001
- start time is given as parameter (as offset to Midnight January 1st 2001, or `"01.01.2001 00:00"`); for example, start time of `10.5 d` means simulation time 0 maps to `"10.01.2001 12:00"`
- if simulation duration exceeds 1 year, simulation time is wrapped at 365 d
- "schedule lookup time" is the same as simulation time
- leap days are never used, even if start year is set to 2000 and similar leap years
- parameter "DayOfTheWeekAtStart" indicates which day of the week corresponds to the first day of simulation (i.e. the day of start time, for example, one could specify "Wed" as day type and in the example above the 10.01. would become a wednesday)

Example:

Simulation takes 2 years, and starts in March 2nd, 12:00  (year 2003, but that is not important)


```
02.03. 12:00  -> t_start = (31+28+1)*24+12 = 1452 h = 60.5 d

t =   0 d -> t_sched = t_start + t = 60.5 d
t = 365 d -> t_sched = t_start + t = 425.5 d

t_sched > 365 ? -> t_sched = t_sched - 365 = 60.5 h

Evaluation at runtime:
scheduleData = scheduleTabulatedSplineData [t_sched=0...365 d]  -> interpolate at t_sched
```

##### Constructing spline data from input data

```
- loop over all days (d=0,1,...,364)
- determine day type:
  d_dayOfWeek = (startDayOffset + d) % 7 (modulo 7)

  startDayOffset = 0 for Monday, 1 for Tuesday, ... , 6 for Sunday
  
Example:
  
  d = 15  -> date = 16. January 2003
  startDayOffset = "Wed" -> 2  (1.1.2003 was a wednesday)
  
  d_dayOfWeek -> 15 + 2 = 17   17 % 7 = 3  -> DayType = "Thursday" (Check: 16. January 2003 was a Thursday)
  
- look up daily cycle:
  - find schedule (back to front) where d in range:
    - process daytypes in order Thursday, Weekdays, AllDays
      - if parameter is found in any of these days, take daily course and add to spline for this day,
      - if parameter not found, skip and search through next schedule
```


## Variable list

The variable list describes all names and the  units that can be used inside the schedules.  

[[tab_VariableList]]
.Variable List
[options="header",cols="35%,^ 10%,55%"]
|====================
|Name 
|Unit|Description
|`HeatingSetPointTemperature`|C| Setpoint temperature for heating.
|`CoolingSetPointTemperature`|C| Setpoint temperature for cooling.
|`AirConditionSetPointTemperature`|C|Setpoint temperature for air conditioning.
|`AirConditionSetPointRelativeHumidity`|%|Setpoint relative humidity for air conditioning.
|`AirConditionSetPointMassFlux`|kg/s|Setpoint mass flux for air conditioning.
|`HeatingLoad`|W|Heating load.
|`ThermalLoad`|W|Thermal load (positive or negative).
|`MoistureLoad`|g/h|Moisture load.
|`CoolingPower`|W|Cooling power.
|`LightingPower`|W|Lighting power.
|`DomesticWaterSetpointTemperature`|C|Setpoint temperature for domestic water.
|`DomesticWaterMassFlow`|kg/s|Domestic water demand mass flow for the complete zone (hot water and equipment).
|`ThermalEnergyLossPerPerson`|W/Person|Energy of a single persons activities that is not available as thermal heat.
|`TotalEnergyProductionPerPerson`|W/Person|Total energy production of a single persons body at a certain activity.
|`MoistureReleasePerPerson`|kg/s|Moisture release of a single persons body at a certain activity.
|`CO2EmissionPerPerson`|kg/s|CO2 emission mass flux of a single person at a certain activity.
|`MassFluxRate`|---|Fraction of real mass flux to maximum  mass flux for different day times.
|`PressureHead`|Pa|Supply pressure head of a pump.
|`OccupancyRate`|---|Fraction of real occupancy to maximum  occupancy for different day times.
|`EquipmentUtilizationRatio`|---|Ratio of usage for existing electric equipment.
|`LightingUtilizationRatio`|---|Ratio of usage for lighting.
|`MaximumSolarRadiationIntensity`|W/m2|Maximum solar radiation intensity before shading is activated.
|`UserVentilationAirChangeRate`|1/h|Exchange rate for natural ventilation.
|`UserVentilationComfortAirChangeRate`|1/h|Maximum air change rate = offset for user comfort.
|`UserVentilationMinimumRoomTemperature`|C|Temperature limit over which comfort ventilation is activated.
|`UserVentilationMaximumRoomTemperature`|C|Temperature limit below which comfort ventilation is activated.
|`InfiltrationAirChangeRate`|1/h|Exchange rate for infiltration.
|`ShadingFactor`|---|Shading factor [0...1].

|====================

