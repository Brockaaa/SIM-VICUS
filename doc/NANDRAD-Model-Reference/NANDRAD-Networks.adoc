:imagesdir: ./images

[[networks]]
# HydraulicNetworks

Dieser Abschnitt beschreibt die Parametrisierung von thermo-hydraulischen Netzwerken.

In einer Projektdatei kann es mehrere Netzwerke geben. Diese sind im XML-tag `HydraulicNetworks` abgelegt.

.Hydraulische Netzwerke
====
[source,xml]
----
<HydraulicNetworks>
	<HydraulicNetwork id="1" displayName="xxx">
        ... <!-- network parameters -->
	</HydraulicNetwork>

	<HydraulicNetwork id="2" displayName="yyy">
        ... <!-- network parameters -->
	</HydraulicNetwork>

    ... <!-- other networks -->
	
</HydraulicNetworks>
----
====

[IMPORTANT]
====
Die einzelnen Netzwerke sind hydraulisch unabhängig, d.h. es gibt keinen Fluidaustausch zwischen Netzwerken. Die Netzwerke können aber thermisch verknüpft sein, z.B. kann ein Quartierswärmenetz mit einem Gebäudeanlagennetz Wärme austauschen. Dies bedingt auch die _eindeutige ID_ der in _allen_ Netzwerken definierten hydraulischen Netzwerkkomponenten.
====



## Definition eines hydraulischen Netzwerks

Ein einzelnes Netzwerk wird im XML-tag `HydraulicNetwork` definiert, wie im folgenden Beispiel:

.Typische Definition eines einzelnen Netzwerks
====
[source,xml]
----
<HydraulicNetwork id="1" displayName="Simple network" modelType="ThermalHydraulicNetwork"
        referenceElementId="201">
	<HydraulicFluid id="1" displayName="Water">
        ... <!-- fluid parameters -->
    </HydraulicFluid>
    
	<PipeProperties>
        ... <!-- database with pipe definitions -->
	</PipeProperties>
	
	<Components>
        ... <!-- database with component definitions -->
	</Components>
	
	<Elements>
        ... <!-- network flow elements with topology definition -->
	</Elements>
	
</HydraulicNetwork>
----
====

Der XML-tag `HydraulicNetwork` hat folgende Attribute:

.Attributes
[options="header",cols="20%,40%,^ 10%,^ 30%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifizierungsnummer | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `displayName`  |  Anzeigename/Beschreibung des Netzwerks | string | _optional_
| `modelType`  |  Legt das Berechnungsmodell fest | string | _optional_ 
 (defaults to `ThermalHydraulicNetwork`)
| `referenceElementId` | ID des Referenzelements | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
|====================

:xrefstyle: short

Das optionale Attribut `modelType` beschreibt, welches Berechnungsmodell zu verwenden ist ( <<tab_network_modelType>>).

[[tab_network_modelType]]
.Werte für Attribut `modelType`
[options="header",cols="30%,70%",width="100%"]
|====================
| Attribut  | Beschreibung
| `HydraulicNetwork` |  Nur die hydraulische Berechnung (Masseströme und Drücke) wird durchgeführt.
| `ThermalHydraulicNetwork`  |  Netzwerk wird mit eingeschalteten Energiebilanzen berechnet. Jedes Strömungselement entspricht mindestens einer Energiebilanzgleichung.
|====================

Die Wahl des Netzwerkberechnungsmodells hat Auswirkungen auf die benötigte Parametrisierung der beteiligten Komponenten.

### Parameter

:xrefstyle: basic

Je nach Modelltyp können mehrere globale Netzwerkparameter definiert werden (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des `IBK:Parameter` tags):

[options="header",cols="30%,^ 10%, 30%,^ 10%,^ 20%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `DefaultFluidTemperature` | C | einheitliche, konstante Fluidtemperatur zur Verwendung mit einem rein hydraulischen Modell | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_  `HydraulicNetwork`
| `InitialFluidTemperature` | C | Anfangsfluidtemperatur | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `ReferencePressure` | Pa | Druck hinter dem Referenzelement | {nbsp}>{nbsp}0.0{nbsp} | _optional_ (Standardwert ist 0 Pa)
|====================


Innerhalb des Netzwerk-Definitionsblocks gibt es vier Kind-Elemente:

- `HydraulicFluid` - <<HydraulicFluid, definiert Medieneigenschaften>>
- `PipeProperties` - <<PipeProperties, Rohreigenschaften>>
- `Components` - <<HydraulicNetworkComponents, Komponentendefinitionen>> 
- `Elements` - <<HydraulicNetworkElements, Netzwerkelemente und Netzwerktopologie>>



[[HydraulicFluid]]
## Medieneigenschaften

Der XML-tag `HydraulicFluid` enthält die Definition des im Netzwerk strömenden Mediums. 

[IMPORTANT]
====
In jedem Netzwerk gibt es nur ein einziges Fluid, und deshalb ist auch nur eine einzige Instanz des `HydraulicFluid` Tags erlaubt.
====

.Definition eines Netzwerkfluids
====
[source,xml]
----
<HydraulicFluid id="1" displayName="Water">
	<IBK:Parameter name="Density" unit="kg/m3">998</IBK:Parameter>
	<IBK:Parameter name="HeatCapacity" unit="J/kgK">4180</IBK:Parameter>
	<IBK:Parameter name="Conductivity" unit="W/mK">0.6</IBK:Parameter>
	<LinearSplineParameter name="KinematicViscosity" interpolationMethod="linear">
		<X unit="C">0 10 20 30 40 50 60 70 80 </X>
		<Y unit="m2/s">1.793e-06 1.307e-06 1.004e-06 8.01e-07 6.58e-07 5.54e-07 4.75e-07 4.13e-07 3.65e-07 </Y>
	</LinearSplineParameter>
</HydraulicFluid>
----
====

Der XML-tag `HydraulicFluid` hat folgende Attribute:

.Attributes
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifikationsnummer | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `displayName`  |  Beschreibung des Fluids | string | _optional_
|====================

[NOTE]
====
Da es nur eine Fluid-Definition per Netzwerk geben darf, ist das _id_ Attribut eigentlich überflüssig. Es wird lediglich zur Aktualisierung der Programmdatenbank beim Import eines Projekts benötigt.
====

:xrefstyle: basic

Parameter des Netzwerkfluids (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des `IBK:Parameter` tags):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Density` | kg/m3 | Dichte bei Referenztemperatur | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `HeatCapacity` | J/kgK | Spezifische Wärmekapazität | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `Conductivity` | W/mK | Wärmeleitfähigkeit bei Referenztemperatur | {nbsp}>={nbsp}0.0{nbsp} | _benötigt_
|====================

[NOTE]
====
Die obigen Eigenschaften, insbesondere die Dichte, werden zur Vereinfachung als temperaturunabhängig konstant angenommen. Für die meisten Anwendungsfälle der thermo-hydraulischen Simulation im Gebäude-/Quartierskontext wird die thermische Ausdehnung des Fluids nicht benötigt. Und die Auslegung des Ausdehngefäßes erfolgt nicht mit der Simulation.
====

Desweiteren gibt es noch temperaturabhängige Parameter, welche in linear interpolierten Datentabellen abgelegt werden (siehe Abschnitt <<LinearSplineParameter>> für eine Beschreibung des  `LinearSplineParameter` Elements):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `KinematicViscosity` | m2/s | Kinematische Viscosität | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
|====================

:xrefstyle: short



[[PipeProperties]]
## Rohreigenschaften

Die Rohreigenschaften legen die physikalische/geometrischen Eigenschaften eines Rohrtyps fest. Diese werden in XML-tags we `HydraulicNetworkPipeProperties` im Katalog `PipeProperties` mit eindeutigen IDs aufgelistet. 

.Definition von Rohreigenschaften
====
[source,xml]
----
<PipeProperties>
	<HydraulicNetworkPipeProperties id="1">
		<IBK:Parameter name="PipeRoughness" unit="m">0.007</IBK:Parameter>
		<IBK:Parameter name="PipeInnerDiameter" unit="mm">25.6</IBK:Parameter>
		<IBK:Parameter name="PipeOuterDiameter" unit="mm">32</IBK:Parameter>
		<IBK:Parameter name="UValuePipeWall" unit="W/mK">5</IBK:Parameter>
	</HydraulicNetworkPipeProperties>
	
	...
</PipeProperties>
----
====

Rohreigenschaften werden über das Attribut `pipePropertyId` eines Netzwerkelements (siehe <<HydraulicNetworkElements>>) referenziert.

.Attribute
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifikationsnummer des Rohrdatensatzes | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
|====================

:xrefstyle: basic

Parameter der Rohreigenschaftem (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des `IBK:Parameter` Tags):

:xrefstyle: short

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PipeRoughness` | mm | Rauhheit der inneren Rohroberfläche | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt_
| `PipeInnerDiameter` | mm | Innendurchmesser des Rohres | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt_
| `PipeOuterDiameter` | mm | Außendurchmesser des Rohres | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt_
| `UValuePipeWall` | W/mK | Längenbezogener äquivalenter U-Wert der Rohrwand (einschließlich Dämmung, wenn vorhanen) | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt (für Rohre mit Wärmeleitung nach Außen)_ 
|====================

Der Außendurchmesser muss größer als der Innendurchmesser sein.

Der längenbezogene äquivalente U-Wert der Rohrwand (einschließlich möglicher Dämmung) ist in der Berechnung so definiert, dass eine Multiplikation mit der Temperaturdifferenz zwischen Fluidtemperatur und Außentemperatur zum Wärmeström pro m Rohrlänge führt. D.h. bei der Berechnung dieses äquivalenten U-Werts müssen Zylinderkoordinaten berücksichtigt werden. Der tatsächlichen Wärmestrom von Fluid zu Umgebung wird noch durch Übergangskoeffizienten (siehe u.A. Abschnitt <<HydraulicElement_SimplePipe>>) beinflusst.



[[HydraulicNetworkComponents]]
## Komponentendefinitionen

Eine `HydraulicNetworkComponent` definiert die Basiseigenschaften eines Strömungselements. Diese werden in dem Katalog `Components` mit eindeutigen IDs aufgelistet.

.Definition einer Komponente
====
[source,xml]
----
<Components>
    <HydraulicNetworkComponent id="1" modelType="ConstantPressurePump">
    	<IBK:Parameter name="PressureHead" unit="Pa">1000</IBK:Parameter>
    	<IBK:Parameter name="Volume" unit="m3">0.01</IBK:Parameter>
    </HydraulicNetworkComponent>
    
    ...
</Components>
----
====

.Attribute
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifikationsnummer der Komponente | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `modelType` |  Modelltyp  | string | _benötigt_
|====================

Die Parameter und Attribute sind dann abhängig vom `modelType` der Komponente und dem `modelType` des Netzwerks.

Im thermischen Modell kann für jeden Modelltyp noch ein (optionales) Wärmeaustauschmodell definiert werden (siehe <<HeatExchangeType>>).



[[HydraulicElement_SimplePipe]]
### Modelltyp: SimplePipe

`SimplePipe` ist ein einfaches Rohrmodell, bei dem das gesamte Rohr als ein zusammenhängendes Fluidvolumen mit entsprechend gemittelten Eigenschaften beschrieben wird.

Für das Model `SimplePipe` werden keine weiteren Parameter benötigt.



[[HydraulicElement_DynamicPipe]]
### Modelltyp: DynamicPipe

Die `DynamicPipe` ist ein detailliertes Rohrmodell, bei dem das Rohr entlang der Rohrlänge räumlich diskretisiert wird. 

Es werden die folgenden Parameter benötigt

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PipeMaxDiscretizationWidth` | m | Länge der diskretisierten Elemente | >0 |_benötigt_
|====================



### Modelltyp: ConstantPressurePump

Für das Model `ConstantPressurePump` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PressureHead` | Pa | Konstante Druckhöhe, welche die Pumpe erzeugt | beliebig | 
| `PumpEfficiency` | - | Gesamtwirkungsgrad der Pumpe | 0...1,{nbsp}>{nbsp}0.0 | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `Volume` | m3 | Fluid volume inside the pump | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================

Die Pumpeneffizienz ist als der mechanische Gesamtwirkungsgrad der Pumpe definiert. D.h. die durch Volumenstrom und Druckhöhe gegebene mechanische Arbeit entspricht diesem Anteil der Gesamtarbeit. Die Differenz der Leistungen wird als Wärmequelle dem Fluid aufgeprägt.



### ModellTyp: HeatExchanger

Das Model `HeatExchanger` ist ein einfacher Wärmeübertrager, welcher mit dem Fluid einen vorgegebenen Wärmestrom austauscht. Es werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `HydraulicDiameter` | mm | Äquivalenter hydraulischer Durchmesser (wird für die Berechnung des Strömungsquerschnitts und der Strömungsgeschwindigkeit benötigt) | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `PressureLossCoefficient` | --- | Effektiver Druckverlustbeiwert | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `Volume` | m3 | Fluidvolumen im Wärmetauscher | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================



[[HydraulicNetworkElements]]
## Strömungselemente

Das eigentliche Netzwerk wird durch die Definition konkreter Strömungselemente aufgebaut. Diese sind untereinander durch Einlass- und Auslassknoten verknüpft. 

Die tatsächlichen Strömungselemente des Netzwerks werden innerhalb des XML-tags `Elements` mit dem XML-tag `HydraulicNetworkElement` definiert. 

.Definition der verknüpften Strömungselemente (Knotennummerierung erfolgt implizit)
====
[[xml_example_flow_element]]
[source,xml]
----
<Elements>
	<HydraulicNetworkElement id="1" inletNodeId="5" outletNodeId="6" componentId="1" pipePropertiesId="1">
		<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
	</HydraulicNetworkElement>
	<HydraulicNetworkElement id="2" inletNodeId="6" outletNodeId="7" componentId="2">
	</HydraulicNetworkElement>
	...
</Elements>
----
====

`HydraulicNetworkElement`-tags haben die folgenden Attribute:

.Attribute
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifikationsnummer des Strömungselements | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `displayName`  |  Anzeigename/Beschreibung (verwendet für Ausgaben) | string | optional
| `inletNodeId` |  ID des Einlassknotens  | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `outletNodeId` |  ID des Einlassknotens  | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `componentId` |  ID des referenzierten  `HydraulicNetworkComponent`  | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `pipePropertiesId` |  ID des referenzierten `HydraulicNetworkPipeProperties` | {nbsp}>{nbsp}0{nbsp}  | optional (_benötigt für Rohre_)
|====================

[IMPORTANT]
====
Die ID eines `HydraulicNetworkElement` muss global eindeutig sein, d.h. Strömungselemente müssen netzwerkübergreifend mit einer eindeutigen ID bezeichnet werden. Komponenten-IDs/Rohreigenschaften-IDs müssen nur innerhalb eines Netzwerkes eindeutig sein.
====

[[fig_network_example1]]
.Einfaches Strömungsnetzwerk mit 3 Knoten und 3 Elementen
image::network_example.png[pdfwidth=8cm]

Die Strömungselemente sind miteinander durch Knoten verknüpft. In jedem Strömungselement fließt das Fluid (geplant) von dem Knoten mit der `inletNodeId` zu dem Knoten mit der `outletNodeId`. Während der Berechnung ist es jedoch möglich, dass sich der Massestrom umkehrt. Dies ändert aber nichts an der Topologiedefinition des Netzwerkes. Man könnte `inletNodeId` auch mit "Knoten 1 des Elements" und `outletNodeId` mit "Knoten 2 des Elements" bezeichnen.

<<fig_network_example1>> zeigt ein einfaches Netzwerk bestehend aus 3 Elementen.  Ein solches Netzwerk würde wie folgt definiert werden (<<ex_network_example1>>).

[[ex_network_example1]]
.XML-Definition eines einfachen Strömungsnetzwerks mit 3 Knoten und 3 Elementen
====
[source,xml]
----
<Elements>
    <!-- Pump -->
	<HydraulicNetworkElement id="1" inletNodeId="1" outletNodeId="2" componentId="1"/>
	<!-- Pipe id=2-->
	<HydraulicNetworkElement id="2" inletNodeId="2" outletNodeId="3" componentId="2" pipePropertiesId="1">
		<IBK:Parameter name="Length" unit="m">10</IBK:Parameter>
	</HydraulicNetworkElement>
	<!-- Pipe id=3-->
    <HydraulicNetworkElement id="3" inletNodeId="3" outletNodeId="1" componentId="2" pipePropertiesId="1">
		<IBK:Parameter name="Length" unit="m">6</IBK:Parameter>
	</HydraulicNetworkElement>
</Elements>
----
====


[NOTE]
====
Verschiedene Strömungselemente sind durch die Knoten IDs `inletNodeId` und `outletNodeId` verknüpft. Die Knoten-IDs referenzieren keine Strömungselemente, sondern "virtuelle" Knoten.
====

Jedes Strömungselement referenziert jeweils eine Komponente mit der `componentId`. 



### Rohr-Elemente

Ist eine Komponente ein Rohr (z.B. `DynamicPipe`), **müssen** entsprechende Rohrparameter mit der `pipePropertiesId` referenziert werden. 

Weiterhin **muss** für ein Rohrelement der Parameter `Length` definiert werden (siehe auch <<ex_pipe_element>>):

[options="header",cols="18%,^ 15%,38%,^ 20%, ^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Length` | m | Rohrlänge | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
|====================

[[ex_pipe_element]]
.Definition eines Rohrelements
====
[source,xml]
----
<HydraulicNetworkElement id="2" inletNodeId="0" outletNodeId="1" componentId="3" pipePropertiesId="1">
	<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
</HydraulicNetworkElement>
----
====

#### Parallele Rohrregister (Flächenheizungen/Fußbodenheizung)

Durch Angabe des `IBK:IntPara` Tags mit dem Namen `NumberParallelPipes` kann man ein Rohrregister definieren und so z.B. eine Flächenheizung/Fußbodenheizung modellieren. Dabei strömt letztlich das Fluid parallel durch die angebene Anzahl gleichartiger Rohre. 

[[ex_pipe_register]]
.Definition eines Rohrregisters
====
[source,xml]
----
<HydraulicNetworkElement id="101" inletNodeId="2" outletNodeId="1" componentId="3" pipePropertiesId="1">
	<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
	<!-- We have a pipe register here, consisting of 10 parallel pipes -->
	<IBK:IntPara name="NumberParallelPipes">10</IBK:IntPara>
</HydraulicNetworkElement>
----
====

[NOTE]
====
Die Ausgabe Massestrom `FluidMassFlux` und Volumenstrom `FluidVolumeFlow` beziehen sich auf das gesamte Rohrbündel.
====

[[HeatExchangeType]]
## Definition der Wärmeaustauschmodells (HeatExchangeType)

Für thermische Netzwerken kann für jedes Strömungselement (<<HydraulicNetworkElements>>) ein Wärmeaustausch definiert werden. Dafür muss innerhalb der Definition des Strömungselements ein XML-Element `HeatExchangeType` definiert werden. 

[[ex_heat_exchange_type]]
.Definition von Strömungselementen mit `HeatExchangeType`
====
[source,xml]
----
<!-- Heat exchange with heat loss/gain pre-defined in time series -->
<HydraulicNetworkElement id="1" inletNodeId="1" outletNodeId="2" componentId="2" displayName="heat exchanger">
    <!-- Definition of pre-defined heat loss -->
	<HydraulicNetworkHeatExchange modelType="HeatLossSpline">
		<LinearSplineParameter name="HeatLoss" interpolationMethod="linear">
			<TSVFile>${Project Directory}/climate/HeatFlux.csv?2</TSVFile>
		</LinearSplineParameter>
	</HydraulicNetworkHeatExchange>
</HydraulicNetworkElement>

<!-- Pipe with heat exchange to the environment (with constant environment temperature) -->
<HydraulicNetworkElement id="2" inletNodeId="2" outletNodeId="3" componentId="3" pipePropertiesId="1" displayName="pipe">
	<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
    <!-- Definition of heat exchange with environment -->
	<HydraulicNetworkHeatExchange modelType="TemperatureConstant">
		<IBK:Parameter name="ExternalHeatTransferCoefficient" unit="W/m2K">5</IBK:Parameter>
		<IBK:Parameter name="Temperature" unit="C">0</IBK:Parameter>
	</HydraulicNetworkHeatExchange>
</HydraulicNetworkElement>
----
====


Der `HeatExchangeType` kann folgende Werte haben:


[options="header",cols="25%,50%, ^ 25%",width="100%"]
|====================
|HeatExchangeType| Beschreibung| Verwendbar für Modelltyp
| `TemperatureConstant` | Wärmeaustausch basierend auf Temperaturunterschied zwischen Medium und Umgebungstemperatur; Konstante Umgebungstemperatur ist als Parameter im `HydraulicNetworkElement` gegeben. Es muss zusätzlich der Parameter `ExternalHeatTransferCoefficient` gegeben sein. | `SimplePipe`, `DynamicPipe` 
| `TemperatureSpline` | Wärmeaustausch basierend auf Temperaturunterschied zwischen Medium und Umgebungstemperatur; Umgebungstemperatur ist als Zeitreihe in einem LinearSplineParameter (<<LinearSplineParameter>>) gegeben. Es muss zusätzlich der Parameter `ExternalHeatTransferCoefficient` gegeben sein. | `SimplePipe`, `DynamicPipe`
| `TemperatureZone` | Wärmeaustausch mit einer Zone; Raumlufttemperatur wird als Umgebungstemperatur verwendet.  | `SimplePipe`, `DynamicPipe`
| `TemperatureConstructionLayer` | Wärmeaustausch mit einer Konstruktionsschicht (Fußbodenheizung/Flächenheizung); Schichttemperatur wird als Umgebungstemperatur verwendet.  | `SimplePipe`, `DynamicPipe`
| `HeatLossConstant` | Konstanter Wärmestrom (positiv aus dem Element) ist als konstanter Parameter gegeben | `SimplePipe`, `DynamicPipe`, `HeatExchanger`
| `HeatLossSpline` | Wärmestrom (positiv aus dem Element) ist als Zeitreihe in einem LinearSplineParameter (<<LinearSplineParameter>>) gegeben | `SimplePipe`, `DynamicPipe`, `HeatExchanger`
| `TemperatureFMUInterface` | Temperatur wird von FMU gegeben |
|====================

[IMPORTANT]
====
Wenn des XML-Element `HeatExchangeType` fehlt, wird die entsprechende Komponente als adiabat behandelt und verlangt entsprechend auch keine weiteren Parameter.
====


### Parameter für Wärmeaustauschdefinition

Konstante Parameter (Tag: `IBK:Parameter`):

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Temperature` | K | konstante Temperatur | {nbsp}>{nbsp}-200.0{nbsp}° C | `TemperatureConstant`

| `ExternalHeatTransferCoefficient` | W/m2K | Äußerer Wärmeübergangskoeffizient | {nbsp}>={nbsp}0.0{nbsp} | `TemperatureConstant`, `TemperatureSpline`, `TemperatureZone`
| `HeatLoss` | W | konstante Wärmeabgabe | --- | `HeatLossConstant`
|====================


Spline-Parameter (Tag: `LinearSplineParameter`):

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Temperature` | K | Zeitreihe mit Temperaturen | --- | `TemperatureSpline`

| `HeatLoss` | W | Zeitreihe mit Wärmeverlustströmen | --- | `HeatLossSpline`
|====================


ID-Referenzen:

[options="header",cols="22%,40%,20%, ^ 18%",width="100%"]
|====================
|XML-Tag-Name | Beschreibung | Verweis auf Datentyp | Verwendung
| `ZoneId` | Referenz zur Zone | `Zone` | `TemperatureZone`
| `ConstructionInstanceId` | Referenz zu beheizter/gekühlter Konstruktion | `ConstructionInstance` | `TemperatureConstructionLayer`
|====================



## Ausgaben

Die Ergebnisgrößen eines thermo-hydraulischen Netzwerkmodells werden wie folgt definiert. Als Referenzierungstyp dient entweder `Network` für Ausgaben des Netzwerks insgesamt, oder `NetworkElement` für die Adressierung individueller Strömungselemente (siehe <<ex_objectList_networks>>).

[[ex_objectList_networks]]
.Objektlist für die Referenzierung eines Netzwerks mit der ID 1 und ausgewählter Elemente des Netzwerks
====
[source,xml]
----
<ObjectLists>
	<ObjectList name="the Network">
		<FilterID>1</FilterID> <!-- ID of network -->
		<ReferenceType>Network</ReferenceType>
	</ObjectList>
	<ObjectList name="Pipes">
		<FilterID>1,3</FilterID> <!-- IDs of flow elements -->
		<ReferenceType>NetworkElement</ReferenceType>
	</ObjectList>
</ObjectLists>
----
====



### Verfügbare Ausgaben

Das Netzwerk-Objekt liefert eine Vielzahl von Ergebnisgrößen für die einzelnen Strömungselemente.

Die Anforderungen an die Netzwerkausgaben richten sich allerdings nach der späteren Visualisierungsebene. Grundlegend ist davon auszugehen, dass im Postprozessing eine weitere Sicht erforderlich sein wird, welche neben dem Gebäude eine Auswertung der hydraulischen Netzwerke erlaubt. Um die Übersichtlichkeit zu wahren, wird diese Sicht von derjenigen des Gebäudes getrennt sein. 

Die Netzwerkausgaben werden daher räumlich getrennt in eigenen Dateien mit dem Namensschema:

- `network_<gridname>.tsv` (für Ausgaben mit Referenztyp `Network`)
- `network_elements_<gridname>.tsv` (für Ausgaben mit Referenztyp `NetworkElement`)

angelegt. Wie bei regulären Ausgaben (siehe <<output_filenames>>) wird der Suffix `_<gridname>` weggelassen, wenn es nur eine Ausgabedatei mit einem Ausgaberaster gibt.

Für Analyse der Netzwerke und Übergabesysteme sind sowohl die Masseströme und Temperaturen im Innere eines Verbindungselementes, aber auch an den Verbindungsstellen zwischen zwei Elementen von Interesse. Letzerer Fall ist beispielsweise typisch für gekoppelte Erzeuger- und Verbraucherkreisläufe, wobei eine Kontrolle der Zulauf- und Rücklauftemperatur möglich sein muss. 

Da die Netzwerkvisualisierungsebene keine Knoten kennt, müssen Knotentemperaturen am Ein- und Auslass des Verbindungselementes abgegriffen werden. Ein- und Auslässe sind unabhängig von der Strömungsrichtung entsprechend der Netzwerktopologie definiert. 

[NOTE]
====
Es wird bei der Topologiedefinition eines Netzwerks mittels der `HydraulicNetworkElement` tags von einer nominalen Strömungsrichtung ausgegangen. Deshalb werden Einlass- und Auslassknoten mittels der IDs `inletNodeId` und `outletNodeId` referenziert. 

Je nach Bedingungen im Netzwerk ist es jedoch auch möglich, dass sich die Strömungsrichtung umkehrt, und das Medium nun auf der Einströmseite eines Rohres ausströmt. Dies wirkt sich zwar im Vorzeichen des Massestroms aus, jedoch nicht in der Bezeichung der _geometrischen_ Ein- und Auslässe eines Strömungselements.
====

[TIP]
====
Mächte man alle Knotendrücke oder Knotentemperaturen erhalten, so kann man einfach von allen Strömungselementen die Drück am Auslass erfragen. Darüber erhält man dann alle Drücke an den jeweiligen Knoten.
====


#### Ausgaben der hydraulischen Netzwerkberechnung

Für jedes Strömungselement kann ein Massestrom ausgegen werden, wobei die Strömungsrichtung immer von _inletNode_ zu _outletNode_ positiv definiert ist. Der Massestrom kann über die Größe `FluidMassFlux` (in kg/s) abgefragt werden (Referenztyp `NetworkElement`).

Ebenso sind für jedes Strömungselement die Drücke am Ein- und Auslass abrufbar: 

- `InletNodePressure` in Pa
- `OutletNodePressure` in Pa


#### Ausgaben der thermo-hydraulischen Berechnung

Jedes Strömungselement hat eine (mittlere) Temperatur, welche über die Ausgabegröße `FluidTemperature` abgefragt werden kann (Referenztyp `NetworkElement`).

[NOTE]
====
Die mittlere Temperatur einen Strömungselements kann zur Visualisierung/Farbgebung des Elements verwendet werden.
====

[CAUTION]
====
Je nach physikalischer Modellierung eines Strömungselements muss die Mitteltemperatur einen Strömungselements nicht mit der Auslasstemperatur übereinstimmen (siehe Modelldokumentation). Beispiele dafür sind Speicher oder lange verlustbehaftete Rohre.
====

Die Temperaturen am Ein- bzw. Auslass sind (wie die Drücke) an den physischen Positionen _inletNode_ und _outletNode_ definiert und können ausgegeben werden. Es sind folgende Ausgabevariablen für den Referenztyp `NetworkElement` definiert:

- `InletNodeTemperature` in C
- `OutletNodeTemperature` in C
- `FlowElementHeatLoss` in W - Wärmestrom abgegeben vom Strömungselement (Energie wird dem Fluid in diesem Element entzogen). Positive Werte bedeuten Abkühlen des Mediums (Wärmeverlust).


Übersicht über Element-Ausgabegrößen:
----
ElectricalPower                    	[W]       	Requested electrical power for current working point
FlowElementHeatLoss                	[W]       	Heat flux from flow element into environment
FluidMassFlux                      	[kg/s]    	Fluid mass flux through a flow element
FluidTemperature                   	[C]       	Internal fluid temperature of network element
FluidVelocity                      	[m/s]     	Fluid velocity
FluidViscosity                     	[m2/s]    	Fluid dynamic viscosity
FluidVolumeFlow                    	[m3/h]    	Fluid Volume flow
InletNodePressure                  	[Pa]      	Fluid pressure at inlet node of a flow element
InletNodeTemperature               	[C]       	Inlet node temperature of a flow element
MechanicalPower                    	[W]       	Mechanical power for current working point
Nusselt                            	[---]     	Nusselt number
OutletNodePressure                 	[Pa]      	Fluid pressure at outlet node of a flow element
OutletNodeTemperature              	[C]       	Outlet node temperature of a flow element
Prandtl                            	[---]     	Prandtl number
PressureDifference                 	[Pa]      	Difference between pressures at outlet and inlet nodes
Reynolds                           	[---]     	Reynolds number
ThermalTransmittance               	[W/K]     	Total thermal transmittance of fluid and pipe wall
----


[TIP]
====
Die Auswahl einzelner Elemente via ID kann über Objektlisten recht flexibel erfolgen.
====


#### Ausgaben des Netzwerks

Zur Vereinfachung gibt es Variablen, welche für ein gesamtes Netzwerk abgerufen werden können (Referenztyp `Network`). Diese enthalten jeweils Ausgaben für alle Strömungselemente.

- `FluidMassFluxes` - Masseströme durch alle Strömungselemente des Netzwerks
- `FluidTemperatures` - Mittlere Temperaturen alle Strömungselemente des Netzwerks

Die Variablen sind vektor-wertige Größen und es muss der __Index__ des jeweils angeforderten Vektorelements verwendet werden. Die Indizierung entspricht der Reihenfolge der  `HydraulicNetworkElement` Tags. <<ex_network_outputs>> zeigt die Definition einer indexbasierten Ausgabe für Masseströme des Netzwerks.

[[ex_network_outputs]]
.Beispiel für Ausgabedefinitionen mit Network als Referenztyp
====
[source,xml]
----
<!-- Outputs go to file 'network.tsv' -->
<OutputDefinition>
	<!-- We choose the flow through the second element (pipe 101) as reference flux
		 for the entire network -->
	<Quantity>FluidMassFluxes[1]</Quantity>
	<ObjectListName>Entire network</ObjectListName>
	<GridName>hourly</GridName>
</OutputDefinition>
----
====


Übersicht über Netzwerk-Ausgabegrößen:
----
FluidMassFluxes(id,4)                     	[kg/s]    	Fluid mass flux trough all flow elements
NetworkZoneHeatLoad(id,1)                 	[W]       	Complete Heat load to zones from all hydraulic network elements
NetworkActiveLayerHeatLoad(id,1)          	[W]       	Heat load to the construction layers from all hydraulic network elements
----


### Variablennamen in Ausgabedateien

Variablen für Ausgaben vom Referenztyp `NetworkElement` werden in den Ausgabedateien wie folgt angegeben: `NetworkElement(id=1).FluidMassFlux` wobei hier `id=1` die ID des ausgewählten Netzwerkelements.


TODO : Datei `VariableSubstitutions.txt` beschreiben.



:xrefstyle: basic

