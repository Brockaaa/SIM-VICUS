:imagesdir: ./images

[[networks]]
# Thermo-hydraulische Netzwerke

Dieser Abschnitt beschreibt die Parametrisierung von thermo-hydraulischen Netzwerken.

In einer Projektdatei kann es mehrere Netzwerke geben. Diese sind im XML-tag `HydraulicNetworks` abgelegt.

.Hydraulische Netzwerke
====
[source,xml]
----
<HydraulicNetworks>
	<HydraulicNetwork id="1" displayName="xxx">
        ... <!-- network parameters -->
	</HydraulicNetwork>

	<HydraulicNetwork id="2" displayName="yyy">
        ... <!-- network parameters -->
	</HydraulicNetwork>

    ... <!-- other networks -->
	
</HydraulicNetworks>
----
====

[IMPORTANT]
====
Die einzelnen Netzwerke sind hydraulisch unabhängig, d.h. es gibt keinen Fluidaustausch zwischen Netzwerken. Die Netzwerke können aber thermisch verknüpft sein, z.B. kann ein Quartierswärmenetz mit einem Gebäudeanlagennetz Wärme austauschen. Dies bedingt auch die _eindeutige ID_ der in _allen_ Netzwerken definierten hydraulischen Netzwerkkomponenten.
====



## Definition eines hydraulischen Netzwerks

Ein einzelnes Netzwerk wird im XML-tag `HydraulicNetwork` definiert, wie im folgenden Beispiel:

.Typische Definition eines einzelnen Netzwerks
====
[source,xml]
----
<HydraulicNetwork id="1" displayName="Simple network" modelType="ThermalHydraulicNetwork"
        referenceElementId="201">
	<HydraulicFluid displayName="Water">
        ... <!-- fluid parameters -->
    </HydraulicFluid>
    
	<PipeProperties>
        ... <!-- database with pipe definitions -->
	</PipeProperties>
	
	<Components>
        ... <!-- database with component definitions -->
	</Components>
	
	<Elements>
        ... <!-- network flow elements with topology definition -->
	</Elements>

	<ControlElements>
        ... <!-- network flow controller parameters -->
	</ControlElements>
	
</HydraulicNetwork>
----
====

Der XML-tag `HydraulicNetwork` hat folgende Attribute:

.Attributes
[options="header",cols="20%,40%,^ 10%,^ 30%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifizierungsnummer | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `displayName`  |  Anzeigename/Beschreibung des Netzwerks | string | _optional_
| `modelType`  |  Legt das Berechnungsmodell fest | string | _optional_ 
 (defaults to `ThermalHydraulicNetwork`)
| `referenceElementId` | ID des Referenzelements | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
|====================

:xrefstyle: short

Das optionale Attribut `modelType` beschreibt, welches Berechnungsmodell zu verwenden ist ( <<tab_network_modelType>>).

[[tab_network_modelType]]
.Werte für Attribut `modelType`
[options="header",cols="30%,70%",width="100%"]
|====================
| Attribut  | Beschreibung
| `HydraulicNetwork` |  Nur die hydraulische Berechnung (Masseströme und Drücke) wird durchgeführt.
| `ThermalHydraulicNetwork`  |  Netzwerk wird mit eingeschalteten Energiebilanzen berechnet. Jedes Strömungselement entspricht mindestens einer Energiebilanzgleichung.
|====================

Die Wahl des Netzwerkberechnungsmodells hat Auswirkungen auf die benötigte Parametrisierung der beteiligten Komponenten.

### Parameter

:xrefstyle: basic

Je nach Modelltyp können mehrere globale Netzwerkparameter definiert werden (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des `IBK:Parameter` tags):

[options="header",cols="30%,^ 10%, 30%,^ 10%,^ 20%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `DefaultFluidTemperature` | C | einheitliche, konstante Fluidtemperatur zur Verwendung mit einem rein hydraulischen Modell | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_  `HydraulicNetwork`
| `InitialFluidTemperature` | C | Anfangsfluidtemperatur | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `ReferencePressure` | Pa | Druck hinter dem Referenzelement | {nbsp}>{nbsp}0.0{nbsp} | _optional_ (Standardwert ist 0 Pa)
|====================


Innerhalb des Netzwerk-Definitionsblocks gibt es vier Kind-Elemente:

- `HydraulicFluid` - <<NetworkHydraulicFluid, definiert Medieneigenschaften>>
- `PipeProperties` - <<NetworkPipeProperties, Rohreigenschaften>>
- `Components` - <<NetworkComponents, Komponentendefinitionen>> 
- `Elements` - <<NetworkElements, Netzwerkelemente und Netzwerktopologie>>
- `ControlElements` - <<NetworkControlElements, Massenstromregler>>


[[NetworkHydraulicFluid]]
## Medieneigenschaften

Der XML-tag `HydraulicFluid` enthält die Definition des im Netzwerk strömenden Mediums. 

[IMPORTANT]
====
In jedem Netzwerk gibt es nur ein einziges Fluid, und deshalb ist auch nur eine einzige Instanz des `HydraulicFluid` Tags erlaubt.
====

.Definition eines Netzwerkfluids
====
[source,xml]
----
<HydraulicFluid displayName="Water">
	<IBK:Parameter name="Density" unit="kg/m3">998</IBK:Parameter>
	<IBK:Parameter name="HeatCapacity" unit="J/kgK">4180</IBK:Parameter>
	<IBK:Parameter name="Conductivity" unit="W/mK">0.6</IBK:Parameter>
	<LinearSplineParameter name="KinematicViscosity" interpolationMethod="linear">
		<X unit="C">0 10 20 30 40 50 60 70 80 </X>
		<Y unit="m2/s">1.793e-06 1.307e-06 1.004e-06 8.01e-07 6.58e-07 5.54e-07 4.75e-07 4.13e-07 3.65e-07 </Y>
	</LinearSplineParameter>
</HydraulicFluid>
----
====

Der XML-tag `HydraulicFluid` hat folgende Attribute:

.Attributes
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `displayName`  |  Beschreibung des Fluids | string | _optional_
|====================


:xrefstyle: basic

Parameter des Netzwerkfluids (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des `IBK:Parameter` tags):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Density` | kg/m3 | Dichte bei Referenztemperatur | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `HeatCapacity` | J/kgK | Spezifische Wärmekapazität | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `Conductivity` | W/mK | Wärmeleitfähigkeit bei Referenztemperatur | {nbsp}>={nbsp}0.0{nbsp} | _benötigt_
|====================

[NOTE]
====
Die obigen Eigenschaften, insbesondere die Dichte, werden zur Vereinfachung als temperaturunabhängig konstant angenommen. Für die meisten Anwendungsfälle der thermo-hydraulischen Simulation im Gebäude-/Quartierskontext wird die thermische Ausdehnung des Fluids nicht benötigt. Und die Auslegung des Ausdehngefäßes erfolgt nicht mit der Simulation.
====

Desweiteren gibt es noch temperaturabhängige Parameter, welche in linear interpolierten Datentabellen abgelegt werden (siehe Abschnitt <<LinearSplineParameter>> für eine Beschreibung des  `LinearSplineParameter` Elements):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `KinematicViscosity` | m2/s | Kinematische Viscosität | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
|====================

:xrefstyle: short



[[NetworkPipeProperties]]
## Rohreigenschaften

Die Rohreigenschaften legen die physikalische/geometrischen Eigenschaften eines Rohrtyps fest. Diese werden im XML-tag `HydraulicNetworkPipeProperties` im Katalog `PipeProperties` mit eindeutigen IDs aufgelistet. 

.Definition von Rohreigenschaften
====
[source,xml]
----
<PipeProperties>
	<HydraulicNetworkPipeProperties id="1">
		<IBK:Parameter name="PipeRoughness" unit="mm">0.07</IBK:Parameter>
		<IBK:Parameter name="PipeInnerDiameter" unit="mm">25.6</IBK:Parameter>
		<IBK:Parameter name="PipeOuterDiameter" unit="mm">32</IBK:Parameter>
		<IBK:Parameter name="UValuePipeWall" unit="W/mK">5</IBK:Parameter>
	</HydraulicNetworkPipeProperties>
	
	...
</PipeProperties>
----
====

Rohreigenschaften werden über das Attribut `pipePropertyId` eines Netzwerkelements (siehe <<NetworkElements>>) referenziert.

.Attribute
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifikationsnummer des Rohrdatensatzes | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
|====================

:xrefstyle: basic

Parameter der Rohreigenschaftem (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des `IBK:Parameter` Tags):

:xrefstyle: short

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PipeRoughness` | mm | Rauhheit der inneren Rohroberfläche | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt_
| `PipeInnerDiameter` | mm | Innendurchmesser des Rohres | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt_
| `PipeOuterDiameter` | mm | Außendurchmesser des Rohres | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt_
| `UValuePipeWall` | W/mK | Längenbezogener äquivalenter U-Wert der Rohrwand (einschließlich Dämmung, wenn vorhanen) | {nbsp}>{nbsp}0.0{nbsp}  | _benötigt (für Rohre mit Wärmeleitung nach Außen)_ 
|====================

Der Außendurchmesser muss größer als der Innendurchmesser sein.

Der längenbezogene äquivalente U-Wert der Rohrwand (einschließlich möglicher Dämmung) ist in der Berechnung so definiert, dass eine Multiplikation mit der Temperaturdifferenz zwischen Fluidtemperatur und Außentemperatur zum Wärmeström pro m Rohrlänge führt. D.h. bei der Berechnung dieses äquivalenten U-Werts müssen Zylinderkoordinaten berücksichtigt werden. Der tatsächlichen Wärmestrom von Fluid zu Umgebung wird noch durch Übergangskoeffizienten (siehe u.A. Abschnitt <<HydraulicElement_SimplePipe>>) beinflusst.



[[NetworkComponents]]
## Komponentendefinitionen

Eine `HydraulicNetworkComponent` definiert die Basiseigenschaften eines Strömungselements. Diese werden in dem Katalog `Components` mit eindeutigen IDs aufgelistet.

.Definition einer Komponente
====
[source,xml]
----
<Components>
    <HydraulicNetworkComponent id="1" modelType="ConstantPressurePump">
    	<IBK:Parameter name="PressureHead" unit="Pa">1000</IBK:Parameter>
    	<IBK:Parameter name="Volume" unit="m3">0.01</IBK:Parameter>
    </HydraulicNetworkComponent>
    
    ...
</Components>
----
====

.Attribute
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifikationsnummer der Komponente | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `modelType` |  Modelltyp  | string | _benötigt_
| `displayName` | Anzeigename/Beschreibung | string | _optional_
|====================

Die weiteren Parameter sind dann abhängig vom `modelType` der Komponente und dem `modelType` des Netzwerks.


[[HydraulicElement_SimplePipe]]
### Modelltyp: SimplePipe

`SimplePipe` ist ein einfaches Rohrmodell, bei dem das gesamte Rohr als ein zusammenhängendes Fluidvolumen mit entsprechend gemittelten Eigenschaften beschrieben wird.

Für das Model `SimplePipe` werden keine weiteren Parameter benötigt.



[[HydraulicElement_DynamicPipe]]
### Modelltyp: DynamicPipe

Die `DynamicPipe` ist ein detailliertes Rohrmodell, bei dem das Rohr entlang der Rohrlänge räumlich diskretisiert wird. 

Es werden die folgenden Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PipeMaxDiscretizationWidth` | m | Länge der diskretisierten Elemente | >0 | _benötigt_
|====================



### Modelltyp: ConstantPressurePump

Diese Komponente prägt eine Druckdifferenz unabhängig vom Massenstrom auf (entspricht einer idealisierten, druckgeregelten Pumpe). Für das Model `ConstantPressurePump` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PressureHead` | Pa | Konstante Druckhöhe, welche die Pumpe erzeugt | beliebig | 
| `PumpEfficiency` | - | Gesamtwirkungsgrad der Pumpe | 0...1,{nbsp}>{nbsp}0.0 | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `FractionOfMotorInefficienciesToFluidStream` | - | Anteil der ans Fluid abgegebenen Wärmeverluste der Pumpe (Standardwert 100%, Nassläufer) | 0...1,{nbsp}>{nbsp}0.0 | _optional für Modelltyp_ `ThermalHydraulicNetwork`
| `Volume` | m3 | Fluid volume inside the pump | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================

Der Parameter `PressureHead` legt eine konstante Druckhöhe fest. Es ist jedoch auch möglich, eine Zeitreihe für diesen Parameter im Zeitplanparameter `PressureHeadSchedule` anzugeben. Wird in solcher Zeitplan für das jeweilige Pumpen-Strömungselement gefunden, so wird dieser Anstelle des konstanten Parameters verwendet.

[WARNING]
====
Im Gegensatz zu anderen Modellen in NANDRAD, bei denen explizit zwischen konstantem Parameter und Zeitplänen unterschieden wird, erfolgt bei diesem Modell die Auswahl nach Verfügbarkeit eines definierten Parameters. Dies birgt das Risiko, dass bei Eingabe-/Modellierungsfehlern (z.B. falsche Objektlisten) der Parameter `PressureHeadSchedule` nicht für das Pumpenelement gefunden wird, und dies nicht zu einer Warnung/Fehlermeldung führt. Stattdessen würde stillschweigend der konstante Parameter verwendet werden.

Da sich dies in den Simulationsergebnissen jedoch leicht erkennen lässt, sollten entsprechende Fehler doch recht einfach zu finden sein. Deshalb wird in diesem Modell auf ein zusätzliches Attribut zur Wahl der Parametrierung verzichtet.
====

[TIP]
====
Die Modellabhängigkeit von der Zeitplanvariable `PressureHeadSchedule` kann genutzt werden, um die Druckhöhe als FMU-Eingangsgröße zu definieren.
====

Die Pumpeneffizienz ist als der mechanische Gesamtwirkungsgrad der Pumpe definiert. D.h. die durch Volumenstrom und Druckhöhe gegebene mechanische Arbeit entspricht diesem Anteil der Gesamtarbeit. Die Differenz der Leistungen wird anteilig entsprechend des Parameters `FractionOfMotorInefficienciesToFluidStream` als Wärmequelle dem Fluid aufgeprägt.



### Modelltyp: ConstantMassFluxPump

Analog zur idealen druckgeführten Pumpe prägt dieses Modell einen vorgegebenen Massenstrom auf. 

[CAUTION]
====
Es ist sehr leicht mit diesen Pumpenelementen unlösbare Gleichungssysteme zu formulieren. Beispielsweise können die Netzwerkgleichgen bei zwei solcher Pumpenelemente in einem seriellen Kreis und unterschiedlichen Vorgabemassenströmen nicht gelöst werden. Bei der Modellierung muss dies entsprechend geprüft werden.
====

Für das Model `ConstantMassFluxPump` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `MassFlux` | kg/s | Vorgegebener Massenstrom durch die Pumpe | >{nbsp}0  | 
| `PumpEfficiency` | - | Gesamtwirkungsgrad der Pumpe | 0...1,{nbsp}>{nbsp}0.0 | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `FractionOfMotorInefficienciesToFluidStream` | - | Anteil der ans Fluid abgegebenen Wärmeverluste der Pumpe (Standardwert 100%, Nassläufer) | 0...1,{nbsp}>{nbsp}0.0 | _optional für Modelltyp_ `ThermalHydraulicNetwork`
| `Volume` | m3 | Fluid volume inside the pump | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================

Wie beim Modelltyp `ConstantPressurePump` kann der konstante Massenstrom im Parameter `MassFlux` durch einen optional gegebenen Zeitplan `MassFluxSchedule` (siehe Erläuterung oben beim Modelltyp `ConstantPressurePump`).

Die Berechnung der Verlustwärme und elektrischen Leistung erfolgt analog zur `ConstantPressurePump`.


### Modelltyp: ControlledPump

Dieses Modell ist ähnlich der `ConstantPressurePump`, mit dem Unterschied, dass die Druckhöhe nicht fest vorgegeben ist, sondern geregelt wird. Dazu können verschiedene Regler verwendet werden (siehe auch <<NetworkControlElements>>).

.Definition einer ControlledPump
====
[source,xml]
----
<!-- Komponentendefinition ist ähnlich der normalen Pumpe -->
<HydraulicNetworkComponent id="1" displayName="Pump" modelType="ControlledPump">
	<IBK:Parameter name="PumpEfficiency" unit="---">1</IBK:Parameter>
	<IBK:Parameter name="Volume" unit="m3">0.01</IBK:Parameter>
	<IBK:Parameter name="MaximumPressureHead" unit="Pa">10000</IBK:Parameter>
	<IBK:Parameter name="PumpMaximumElectricalPower" unit="W">50</IBK:Parameter>
</HydraulicNetworkComponent>

...

<!-- Das dazugehörige Element muss eine Kontrollelement referenzieren -->
<HydraulicNetworkElement id="1" inletNodeId="100" outletNodeId="0" componentId="1" controlElementId="1" displayName="Pump" />
----
====


Für das Model `ControlledPump` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PumpEfficiency` | - | Gesamtwirkungsgrad der Pumpe | 0...1,{nbsp}>{nbsp}0.0 | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `FractionOfMotorInefficienciesToFluidStream` | - | Anteil der ans Fluid abgegebenen Wärmeverluste der Pumpe (Standardwert 100%, Nassläufer) | 0...1,{nbsp}>{nbsp}0.0 | _optional für Modelltyp_ `ThermalHydraulicNetwork`
| `Volume` | m3 | Fluid volume inside the pump | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `MaximumPressureHead` | Pa | Maximum pressure head at point of minimal mass flow
| {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `PumpMaximumElectricalPower` | W | Maximum electrical power at point of optimal operation
| {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================

Aus der maximalen Druckhöhe bei minimalem Durchfluss (`MaximumPressureHead`) und der maximalen Leistung im optimalen Betriebspunkt (`PumpMaximumElectricalPower`) berechnet das Modell die tatsächliche maximale Druckhöhe in Abhängigkeit des aktuellen Massenstroms. Diese tatsächliche maximale Druckhöhe sinkt mit zunehmenden Massenstrom linear und ist somit in der Regel geringer als die maximale Druckhöhe bei minimalem Durchfluss (`MaximumPressureHead`).

Das jeweilige Strömungselement (<<NetworkElements>>) referenziert im Attribut `controlElementId` einen Regler (siehe auch <<NetworkControlElements>>). Dieser bestimmt das Regelverhalten der Pumpe.


[[HydraulicElement_ConstantPressureLossValve]]
### Modelltyp: ConstantPressureLossValve

Dieses Modell bildet ein Ventil ab, welches unabhängig vom Massenstrom einen konstanten Druckverlust erzeugt.

Für das Model `ConstantPressureLossValve` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `PressureLoss` | Pa | Vorgegebener Druckverlust des Ventils | >={nbsp}0  | 
| `Volume` | m3 | Fluidvolumen des Ventils | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================


[[HydraulicElement_ControlledValve]]
### Modelltyp: ControlledValve

Ein Ventil, welches nach bestimmten Kriterien geregelt wird. Letztlich ist dies ein normales Druckverlustelement, bei dem der letztlich wirksame Druckverlust dynamisch geregelt wird.

Für das Model `ControlledValve` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `HydraulicDiameter` | mm | Äquivalenter hydraulischer Durchmesser (wird für die Berechnung des Strömungsquerschnitts und der Strömungsgeschwindigkeit benötigt) | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `PressureLossCoefficient` | --- | Effektiver Druckverlustbeiwert | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `Volume` | m3 | Fluidvolumen im Wärmetauscher | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================

Ein durchströmtes Element, welches eine Komponente von Modelltyp `ControlledValve` verwendet, referenziert in der Regel (aber nicht zwingend) ein Kontrollelement (siehe <<NetworkControlElements>>). Diese Massenstromkontroller erhöhen den Basisdruckverlustbeiwert. Ohne ein Kontrollelement verhält sich das `ControlledValve` einfach wie eine normales, druckverlustbehaftetes Element im Strömungsnetzwerk.


### ModellTyp: HeatExchanger

Das Model `HeatExchanger` ist ein einfacher Wärmeübertrager, welcher mit dem Fluid einen vorgegebenen Wärmestrom austauscht. Es werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `HydraulicDiameter` | mm | Äquivalenter hydraulischer Durchmesser (wird für die Berechnung des Strömungsquerschnitts und der Strömungsgeschwindigkeit benötigt) | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `PressureLossCoefficient` | --- | Effektiver Druckverlustbeiwert | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `Volume` | m3 | Fluidvolumen im Wärmetauscher | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================


[[HydraulicElement_HeatPumpIdealCarnotSourceSide]]
### ModellTyp: HeatPumpIdealCarnotSourceSide

Das Model `HeatPumpIdealCarnotSourceSide` ist eine ideale Wärmepumpe mit gegebener Carnot-Effizienz, welche die Quellenseite der Wärmepumpe modelliert. Mit diesem Modell wird also der Wärmeübertrager der kalten Seite (Verdampfer) der Wärmepumpe als Teil des Netzwerks modelliert. Dem Fluid wird dort Wärme entzogen. Die von der Wärmepumpe erzeugte Wärme an der warmen Seite (Kondensator) wird durch ein Wärmeaustauschmodell (<<NetworkHeatExchange>>) als Randbedingung angegeben. Weiterhin muss die mittlere Kondensatortemperatur (d.h. der geschätzte Mittelwert zwischen Ein- und Austrittstemperatur am Kondensator, z.B. 32.5°C) in Form eines Schedules mit der Bezeichnung `CondenserMeanTemperatureSchedule` angegeben werden.

Weiterhin werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
[[Parameter_HeatPumpIdealCarnotSourceSide]]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `HydraulicDiameter` | mm | Äquivalenter hydraulischer Durchmesser (wird für die Berechnung des Strömungsquerschnitts und der Strömungsgeschwindigkeit benötigt) | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `PressureLossCoefficient` | --- | Effektiver Druckverlustbeiwert | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `Volume` | m3 | Fluidvolumen im Wärmetauscher | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `CarnotEfficiency` | --- | Carnot-Faktor zur Berechnung des COP | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
| `MaximumHeatingPower` | W | Maximale Heizleistung (= maximaler Wärmestrom des Kondensators) | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================


[IMPORTANT]
Wenn die Differenz zwischen mittlerer Kondensatortemperatur und mittlerer Verdampfertemperatur weniger als 4 K beträgt oder die Verdampfertemperatur 20°C unterschreitet, wird eine Warnung ausgegeben und die Wärmepumpe ist ausgeschaltet. Alle Ausgaben des Modells sind dann auf 0.0 gesetzt.

[[ex_HeatPumpIdealCarnotSourceSide]]
.Definition einer HeatPumpIdealCarnotSourceSide
====
[source,xml]
----
<Components>
    <HydraulicNetworkComponent id="2" modelType="HeatPumpIdealCarnotSourceSide">
    	<IBK:Parameter name="HydraulicDiameter" unit="mm">25.6</IBK:Parameter>
    	<IBK:Parameter name="PressureLossCoefficient" unit="-">5</IBK:Parameter>
    	<IBK:Parameter name="Volume" unit="m3">0.001</IBK:Parameter>
    	<IBK:Parameter name="CarnotEfficiency" unit="---">0.4</IBK:Parameter>
    	<IBK:Parameter name="MaximumHeatingPower" unit="W">4000</IBK:Parameter>
    </HydraulicNetworkComponent>
</Components>

<Elements>
    <HydraulicNetworkElement id="1" inletNodeId="2" outletNodeId="0" componentId="2" displayName="heatpump">
    	<HydraulicNetworkHeatExchange modelType="HeatLossSplineCondenser">
    		<LinearSplineParameter name="HeatLoss" interpolationMethod="linear">
    			<TSVFile>${Project Directory}/file/to/HeatFluxCondenser.csv</TSVFile>
    		</LinearSplineParameter>
    	</HydraulicNetworkHeatExchange>
    </HydraulicNetworkElement>
</Elements>
----
====



### ModellTyp: HeatPumpIdealCarnotSupplySide

Das Model `HeatPumpIdealCarnotSupplySide` ist eine ideale Wärmepumpe mit gegebener Carnot-Effizienz, welche die Senkenseite der Wärmepumpe modelliert. Mit diesem Modell wird also der Wärmeübertrager der warmen Seite (Kondensator) der Wärmepumpe als Teil des Netzwerks modelliert. Die auf der kalten Seite gegebene Temperatur wird durch ein Wärmeaustauschmodell (<<NetworkHeatExchange>>) als Randbedingung angegeben. Die Wärmeabgabe der Wärmepumpe wird ideal geregelt so dass immer die gegebene Kondensatoraustrittstemperatur (= Heizungsvorlauftemperatur, z.B. 35°C) erreicht wird. die Kondensatoraustrittstemperatur muss in Form eines Schedules mit der Bezeichnung `CondenserOutletSetpointSchedule` angegeben werden.

Die benötigten Parameter sind identisch mit dem Modell <<HydraulicElement_HeatPumpIdealCarnotSourceSide>> und in <<Parameter_HeatPumpIdealCarnotSourceSide>> gegeben.


[[HydraulicElement_HeatPumpRealSourceSide]]
### Modelltyp: HeatPumpRealSourceSide

Dieses Model stellt eine reale On/Off-Wärmepumpe dar, welche nur an oder ausgeschaltet werden kann. Die Leistung und Effizienz werden durch Polynome bestimmt. Das Modell bildet die Quellenseite der Wärmepumpe ab, es wird also der Wärmeübertrager der kalten Seite (Verdampfer) der Wärmepumpe als Teil des Netzwerks modelliert. 

Es werden je 6 Polynomkoeffizienten (`PolynomCoefficients`) für die Berechnung der Wärmeabgabe des Kondensators und der elektrischen Leistung werden in Form eines `DataTable` benötigt (siehe <<ex_HeatPumpRealSourceSide>>). Es wird ein `Schedule` für das Signal zum An- und Ausschalten der Wärmepumpe mit der Bezeichnug `HeatPumpOnOffSignalSchedule` und ein `Schedule` für die Kondensatoraustrittstemperatur mit der Beziechnung `CondenserOutletSetpointSchedule` benötigt.

Weitere benötigte Parameter sind:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `HydraulicDiameter` | mm | Äquivalenter hydraulischer Durchmesser (wird für die Berechnung des Strömungsquerschnitts und der Strömungsgeschwindigkeit benötigt) | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `PressureLossCoefficient` | --- | Effektiver Druckverlustbeiwert | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
| `Volume` | m3 | Fluidvolumen im Wärmetauscher | {nbsp}>{nbsp}0.0{nbsp} | _benötigt für Modelltyp_ `ThermalHydraulicNetwork`
|====================


[[ex_HeatPumpRealSourceSide]]
.Definition einer HeatPumpRealSourceSide
====
[source,xml]
----
<Components>
    <HydraulicNetworkComponent id="2" modelType="HeatPumpRealSourceSide">
    	<IBK:Parameter name="HydraulicDiameter" unit="mm">25.6</IBK:Parameter>
    	<IBK:Parameter name="PressureLossCoefficient" unit="---">5</IBK:Parameter>
    	<IBK:Parameter name="Volume" unit="m3">0.001</IBK:Parameter>
    	<PolynomCoefficients>
    		QdotCondensator: 9.92879892e+00 2.88001670e-01 -6.14962264e-02 -1.64339623e-03 1.82864120e-03 1.89999998e-04;
    		Pel: 9.67904904e-01 -1.15618685e-03 4.19591509e-03 9.77264129e-05 -2.20526428e-04 4.61199998e-04
    	</PolynomCoefficients>
    </HydraulicNetworkComponent>
</Components>
...
<Elements>
    <HydraulicNetworkElement id="1003" inletNodeId="2" outletNodeId="0" componentId="2" displayName="heatpump">
	</HydraulicNetworkElement>
</Elements>
...
<Schedule type="AllDays">
	<DailyCycles>
		<!-- Condenser Temperature is usually 35°C for space heating and two times per day 50°C for domestic hot water-->
		<DailyCycle interpolation="Constant">
			<TimePoints>0,6,8,18,20</TimePoints>
			<Values>CondenserOutletSetpointSchedule [C]:35,55,35,55,35;</Values>
		</DailyCycle>
		<DailyCycle interpolation="Constant">
			<TimePoints>0,2,8,16,22</TimePoints>
			<Values>HeatPumpOnOffSignalSchedule [---]:0,1,0,1,0;</Values>
		</DailyCycle>
	</DailyCycles>
</Schedule>
----
====


[[HydraulicElement_IdealHeaterCooler]]
### Modelltyp: IdealHeaterCooler

Dieses Modell ermöglicht das präzise Vorgeben einer Medientemperatur in einem Strömungselement und der Berechnung der für die Temperaturänderung benötigten Heiz-/Kühlenergie.


[[ex_HydraulicElement_IdealHeaterCooler]]
.Definition der verknüpften Strömungselemente (Knotennummerierung erfolgt implizit)
====
[source,xml]
----
<Components>
    ...
    
	<HydraulicNetworkComponent id="3" displayName="ideal heater cooler" modelType="IdealHeaterCooler"/>
</Components>

<Elements>

    ...

    <!-- The ideal heat exchanger element requires 'SupplyTemperatureSchedule' schedule parameter -->
	<HydraulicNetworkElement id="3" inletNodeId="101" outletNodeId="100" componentId="3" displayName="Perfect heater/cooler"/>

</Elements>

...

    <ScheduleGroup objectList="Ideal heat exchanger">
    	<Schedule type="AllDays">
    		<DailyCycles>
    			<DailyCycle interpolation="Constant">
    				<TimePoints>0 6 18</TimePoints>
    				<Values>
    					SupplyTemperatureSchedule [C]:22 35 22
    				</Values>
    			</DailyCycle>
    		</DailyCycles>
    	</Schedule>
    </ScheduleGroup>

...

	<ObjectList name="Ideal heat exchanger">
		<FilterID>3</FilterID>
		<ReferenceType>NetworkElement</ReferenceType>
	</ObjectList>

----
====

Es sind keine weiteren Parameter notwendig. Es wird der Zeitplanparameter `SupplyTemperatureSchedule` erwartet (siehe <<ex_HydraulicElement_IdealHeaterCooler>>).



[[NetworkElements]]
## Strömungselemente

Das eigentliche Netzwerk wird durch die Definition konkreter Strömungselemente aufgebaut. Diese sind untereinander durch Einlass- und Auslassknoten verknüpft. 

Die tatsächlichen Strömungselemente des Netzwerks werden innerhalb des XML-tags `Elements` mit dem XML-tag `HydraulicNetworkElement` definiert. 

[[xml_example_flow_element]]
.Definition der verknüpften Strömungselemente (Knotennummerierung erfolgt implizit)
====
[source,xml]
----
<Elements>
	<HydraulicNetworkElement id="1" inletNodeId="5" outletNodeId="6" componentId="1" pipePropertiesId="1">
		<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
	</HydraulicNetworkElement>
	<HydraulicNetworkElement id="2" inletNodeId="6" outletNodeId="7" componentId="2">
	</HydraulicNetworkElement>
	...
</Elements>
----
====

`HydraulicNetworkElement`-tags haben die folgenden Attribute:

.Attribute
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut  | Beschreibung | Format | Verwendung
| `id` |  Eindeutige Identifikationsnummer des Strömungselements | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `displayName`  |  Anzeigename/Beschreibung (verwendet für Ausgaben) | string | optional
| `inletNodeId` |  ID des Einlassknotens  | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `outletNodeId` |  ID des Einlassknotens  | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `componentId` |  ID des referenzierten  `HydraulicNetworkComponent`  | {nbsp}>{nbsp}0{nbsp}  | _benötigt_
| `pipePropertiesId` |  ID des referenzierten `HydraulicNetworkPipeProperties` | {nbsp}>{nbsp}0{nbsp}  | optional (_benötigt für Rohre_)
|====================

[IMPORTANT]
====
Die ID eines `HydraulicNetworkElement` muss global eindeutig sein, d.h. Strömungselemente müssen netzwerkübergreifend mit einer eindeutigen ID bezeichnet werden. Komponenten-IDs/Rohreigenschaften-IDs müssen nur innerhalb eines Netzwerkes eindeutig sein.
====

[[fig_network_example1]]
.Einfaches Strömungsnetzwerk mit 3 Knoten und 3 Elementen
image::network_example.png[pdfwidth=8cm]

Die Strömungselemente sind miteinander durch Knoten verknüpft. In jedem Strömungselement fließt das Fluid (geplant) von dem Knoten mit der `inletNodeId` zu dem Knoten mit der `outletNodeId`. Während der Berechnung ist es jedoch möglich, dass sich der Massestrom umkehrt. Dies ändert aber nichts an der Topologiedefinition des Netzwerkes. Man könnte `inletNodeId` auch mit "Knoten 1 des Elements" und `outletNodeId` mit "Knoten 2 des Elements" bezeichnen.

<<fig_network_example1>> zeigt ein einfaches Netzwerk bestehend aus 3 Elementen.  Ein solches Netzwerk würde wie folgt definiert werden (<<ex_network_example1>>).

[[ex_network_example1]]
.XML-Definition eines einfachen Strömungsnetzwerks mit 3 Knoten und 3 Elementen
====
[source,xml]
----
<Elements>
    <!-- Pump -->
	<HydraulicNetworkElement id="1" inletNodeId="1" outletNodeId="2" componentId="1"/>
	<!-- Pipe id=2-->
	<HydraulicNetworkElement id="2" inletNodeId="2" outletNodeId="3" componentId="2" pipePropertiesId="1">
		<IBK:Parameter name="Length" unit="m">10</IBK:Parameter>
	</HydraulicNetworkElement>
	<!-- Pipe id=3-->
    <HydraulicNetworkElement id="3" inletNodeId="3" outletNodeId="1" componentId="2" pipePropertiesId="1">
		<IBK:Parameter name="Length" unit="m">6</IBK:Parameter>
	</HydraulicNetworkElement>
</Elements>
----
====


[NOTE]
====
Verschiedene Strömungselemente sind durch die Knoten IDs `inletNodeId` und `outletNodeId` verknüpft. Die Knoten-IDs referenzieren keine Strömungselemente, sondern "virtuelle" Knoten.
====

Jedes Strömungselement referenziert jeweils eine Komponente mit der `componentId`. 



### Rohr-Elemente

Ist eine Komponente ein Rohr (z.B. `DynamicPipe`), **müssen** entsprechende Rohrparameter mit der `pipePropertiesId` referenziert werden. 

Weiterhin **muss** für ein Rohrelement der Parameter `Length` definiert werden (siehe auch <<ex_pipe_element>>):

[options="header",cols="18%,^ 15%,38%,^ 20%, ^ 10%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Length` | m | Rohrlänge | {nbsp}>{nbsp}0.0{nbsp} | _benötigt_
|====================

[[ex_pipe_element]]
.Definition eines Rohrelements
====
[source,xml]
----
<HydraulicNetworkElement id="2" inletNodeId="0" outletNodeId="1" componentId="3" pipePropertiesId="1">
	<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
</HydraulicNetworkElement>
----
====


#### Parallele Rohrregister (Flächenheizungen/Fußbodenheizung)

Durch Angabe des `IBK:IntPara` Tags mit dem Namen `NumberParallelPipes` kann man ein Rohrregister definieren und so z.B. eine Flächenheizung/Fußbodenheizung modellieren. Dabei strömt letztlich das Fluid parallel durch die angebene Anzahl gleichartiger Rohre. 

[[ex_pipe_register]]
.Definition eines Rohrregisters
====
[source,xml]
----
<HydraulicNetworkElement id="101" inletNodeId="2" outletNodeId="1" componentId="3" pipePropertiesId="1">
	<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
	<!-- We have a pipe register here, consisting of 10 parallel pipes -->
	<IBK:IntPara name="NumberParallelPipes">10</IBK:IntPara>
</HydraulicNetworkElement>
----
====

[NOTE]
====
Die Ausgabe Massestrom `FluidMassFlux` und Volumenstrom `FluidVolumeFlow` beziehen sich auf das gesamte Rohrbündel.
====


[[NetworkHeatExchange]]
## Wärmeaustauschmodelle

In thermische Netzwerken kann für ein Strömungselement (<<NetworkElements>>) ein Wärmeaustausch (mit der Umgebung, anderen Modellen, etc.) definiert werden. Dafür muss innerhalb der Definition des Strömungselements ein XML-Element `HydraulicNetworkHeatExchange` definiert werden. 

[[ex_heat_exchange_type]]
.Definition von Strömungselementen mit `HydraulicNetworkHeatExchange`
====
[source,xml]
----
<!-- Heat exchange with heat loss/gain pre-defined in time series -->
<HydraulicNetworkElement id="1" inletNodeId="1" outletNodeId="2"
    componentId="2" displayName="heat exchanger">
    
    <!-- Definition of pre-defined heat loss -->
	<HydraulicNetworkHeatExchange modelType="HeatLossSpline">
		<LinearSplineParameter name="HeatLoss" interpolationMethod="linear">
			<TSVFile>${Project Directory}/climate/HeatFlux.csv?2</TSVFile>
		</LinearSplineParameter>
	</HydraulicNetworkHeatExchange>
</HydraulicNetworkElement>

<!-- Pipe with heat exchange to the environment (with constant environment temperature) -->
<HydraulicNetworkElement id="2" inletNodeId="2" outletNodeId="3"
    componentId="3" pipePropertiesId="1" displayName="pipe">
    
	<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
    <!-- Definition of heat exchange with environment -->
	<HydraulicNetworkHeatExchange modelType="TemperatureConstant">
		<IBK:Parameter name="ExternalHeatTransferCoefficient" unit="W/m2K">5</IBK:Parameter>
		<IBK:Parameter name="Temperature" unit="C">0</IBK:Parameter>
	</HydraulicNetworkHeatExchange>
</HydraulicNetworkElement>
----
====


Es gibt verschiedene Modelltypen für den Wärmeaustausch, angegeben über das Attribut `modelType`:


[options="header",cols="25%,50%, ^ 25%",width="100%"]
|====================
|`modelType`| Beschreibung| Verwendbar für Komponente

| `TemperatureConstant` | Wärmeaustausch basierend auf Temperaturunterschied zwischen Medium und Umgebungstemperatur; Konstante Umgebungstemperatur ist als Parameter `Temperature` im `HydraulicNetworkElement` gegeben. Es muss zusätzlich der Parameter `ExternalHeatTransferCoefficient` gegeben sein. | `SimplePipe`, `DynamicPipe`

| `TemperatureSpline` | Wärmeaustausch basierend auf Temperaturunterschied zwischen Medium und Umgebungstemperatur; Umgebungstemperatur ist als Zeitreihe in einem LinearSplineParameter (<<LinearSplineParameter>>) mit Namen `Temperature` gegeben. Es muss zusätzlich der Parameter `ExternalHeatTransferCoefficient` gegeben sein. | `SimplePipe`, `DynamicPipe`

| `TemperatureSplineEvaporator` | Wärmeaustasch via Wärmepumpe, basierend auf gegebener Verdampfertemperatur. Verdampfertemperatur ist als  Zeitreihe in einem LinearSplineParameter (<<LinearSplineParameter>>) mit Namen `Temperature` gegeben | `HeatPumpIdealCarnot`

| `TemperatureZone` | Wärmeaustausch mit einer Zone. Raumlufttemperatur der referenzierten Zone (`ZoneId`) wird als Umgebungstemperatur verwendet. Es muss zusätzlich der Parameter `ExternalHeatTransferCoefficient` gegeben sein. | `SimplePipe`, `DynamicPipe`

| `TemperatureConstructionLayer` | Wärmeaustausch mit einer Konstruktionsschicht (Fußbodenheizung/Flächenheizung); Schichttemperatur (aktive Schicht) der referenzierten Konstruktion (`ConstructionInstanceId`) wird als Umgebungstemperatur verwendet.  | `SimplePipe`, `DynamicPipe`

| `HeatLossConstant` | Konstanter Wärmestrom (positiv aus dem Element) ist als konstanter Parameter `HeatLoss` gegeben. | `SimplePipe`, `DynamicPipe`, `HeatExchanger`

| `HeatLossSpline` | Wärmestrom (positiv aus dem Element) ist als Zeitreihe in einem LinearSplineParameter (<<LinearSplineParameter>>) mit Namen `HeatLoss` gegeben | `SimplePipe`, `DynamicPipe`, `HeatExchanger`

| `HeatLossSplineCondenser` | Wärmestrom (positiv aus dem Element) des Kondensators bei Verwendung eines Wärmepumpen-Modells als Zeitreihe in einem LinearSplineParameter (<<LinearSplineParameter>>) mit Namen `HeatLoss` gegeben | `HeatPumpIdealCarnot`
|====================

[IMPORTANT]
====
Wenn des XML-Element `HydraulicNetworkHeatExchange` fehlt, wird die entsprechende Komponente als adiabat behandelt.
====


### Parameter für Wärmeaustauschdefinition

Konstante Parameter (Tag: `IBK:Parameter`):

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Temperature` | K | konstante Temperatur | {nbsp}>{nbsp}-200.0{nbsp}° C | `TemperatureConstant`

| `ExternalHeatTransferCoefficient` | W/m2K | Äußerer Wärmeübergangskoeffizient | {nbsp}>={nbsp}0.0{nbsp} | `TemperatureConstant`, `TemperatureSpline`, `TemperatureZone`
| `HeatLoss` | W | konstante Wärmeabgabe | --- | `HeatLossConstant`
|====================


Spline-Parameter (Tag: `LinearSplineParameter`):

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name | Einheit | Beschreibung | Wertebereich | Verwendung
| `Temperature` | K | Zeitreihe mit Temperaturen | --- | `TemperatureSpline`

| `HeatLoss` | W | Zeitreihe mit Wärmeverlustströmen | --- | `HeatLossSpline`, `HeatLossSplineCondenser`
|====================


ID-Referenzen:

[options="header",cols="22%,40%,20%, ^ 18%",width="100%"]
|====================
|XML-Tag-Name | Beschreibung | Verweis auf Datentyp | Verwendung
| `ZoneId` | Referenz zur Zone | `Zone` | `TemperatureZone`
| `ConstructionInstanceId` | Referenz zu beheizter/gekühlter Konstruktion | `ConstructionInstance` | `TemperatureConstructionLayer`
|====================

## Regelung von Strömungselementen

Strömungselemente können ein geregeltes Ventil enthalten. Das Ventil wird z.B. so geregelt, dass eine vorgegebene Temperaturdifferenz oder ein vorgegebener Massenstrom erreicht wird. Im <<ex_controlled_heat_exchanger>> referenziert
das `HydraulicNetworkElement` dafür ein `HydraulicNetworkControlElement` im Attribut `controlElementId`.

[[ex_controlled_heat_exchanger]]
.Beispiel für ein Wärmeübertrager mit geregelter Temperaturdifferenz
====
[source,xml]
----
<HydraulicNetworkElement id="2" inletNodeId="0" outletNodeId="101" componentId="2" 
    controlElementId="1" displayName="Heat exchanger">
	<HydraulicNetworkHeatExchange modelType="HeatLossSpline">
		<LinearSplineParameter name="HeatLoss">
			<X unit="d">0 1   2    2.2  2.3  2.7  2.8 3</X>
			<Y unit="W">0 500 1000 1000 3000 3000 800 0</Y>
		</LinearSplineParameter>
	</HydraulicNetworkHeatExchange>

</HydraulicNetworkElement>
...
<ControlElements>
	<HydraulicNetworkControlElement id="1" controlledProperty="TemperatureDifference" modelType="Constant" controllerType="PController" >
		<IBK:Parameter name="Kp" unit="---">1e6</IBK:Parameter>
		<IBK:Parameter name="TemperatureDifferenceSetpoint" unit="K">3</IBK:Parameter>
		<!-- Deactivate upper limit of controller result value
		     - this is the default and could be omitted -->
		<MaximumControllerResultValue>0</MaximumControllerResultValue>
	</HydraulicNetworkControlElement>
</ControlElements>
----
====

Die konkrete Parametrierung des Kontrollers ist im referenzierten `HydraulicNetworkControlElement` enthalten. Die Massenstromregler arbeiten unterschiedlich und verlangen dabei wie im <<ex_controlled_heat_exchanger>> eine entsprechende Wärmeaustauschparametrierung (`HydraulicNetworkHeatExchange`). Details zu diesen Abhängigkeiten sind in Abschnitt <<NetworkControlElements>> beschrieben.


[[NetworkControlElements]]
## Regler und Massenstromkontrollmodelle

Alle Reglerkomponenten werden in einer Liste `ControlElements` abgelegt, welche sich innerhalb des `HydraulicNetwork` Elements befindet.

[[ex_controlElement]]
.Definitionsliste von Massenstrom-Reglermodellen
====
[source,xml]
----
<ControlElements>
	<!-- This controller generates a control signal based on
	     temperature difference using a P-controller.
		 The temperature difference is computed from heat loss
		 and current mass flux. Hence, this controller can only
		 be used in a flow element that defines heat exchange
		 via prescribed heat loss.
		 This control element can be referenced by all flow
		 elements with similar mass flow control strategy.
	-->
	<HydraulicNetworkControlElement id="1" controlledProperty="TemperatureDifference" modelType="Constant" controllerType="PController" >
		<IBK:Parameter name="Kp" unit="---">1e6</IBK:Parameter>
		<IBK:Parameter name="TemperatureDifferenceSetpoint" unit="K">3</IBK:Parameter>
		<!-- Deactivate upper limit of controller result value
		     - this is the default and could be omitted -->
		<MaximumControllerResultValue>0</MaximumControllerResultValue>
	</HydraulicNetworkControlElement>
</ControlElements>
----
====

Eine Reglerdefinition `HydraulicNetworkControlElement` beschreibt sowohl die Sensorgröße(n), das Berechnungsverfahren für das Reglereingangssignal und das Reglermodell selbst (P, PI-Regler, ...). Das Ergebnis des Reglers ist ein zusätzlicher Druckverlustbeiwert zwischen 0 (kein zusätzlicher Strömungswiderstand) bis zu einem sehr hohen Wert (bspw. Ventil geschlossen).

Die Art der Regelung bzw. die zu überwachende Größe wird im Attribut `controlledProperty` definiert. 
Das Attribute `modelType` (Optionen `Constant` oder `Scheduled`) definiert, ob die Setpoints als feste Parameter im `HydraulicNetworkControlElement` angegeben sind, oder als Zeitplanparameter angegeben sind.

### Regler: TemperatureDifference

Dieser Regler kann nur bei Elementen mit vorgegebenem Wärmeverluststrom verwendet werden (Wärmeaustauschmodell `HeatLossConstant` oder `HeatLossSpline`). Aus dem gegebenen Wärmeverlust wird mit dem aktuellen Massenstrom der Temperaturabfall über dem Strömungselement berechnet. Dieser wird mit einem Sollwert (Parameter `TemperatureDifferenceSetpoint`) verglichen - die Differenz zwischen Sollwert und Ist-Temperturdifferenz ist das Reglereingangssignal (Fehlerwert).

der Regler `TemperatureDifference` kann nur für das Modell `HeatExchanger` verwendet werden.

### Regler: TemperatureDifferenceOfFollowingElement

Mit diesem Regler wird ein Ventil implementiert, welches die Temperaturdifferenz des nächsten Strömungselements (in Verknüpfungsreihenfolge) regelt. Das nächste Strömungselement wird automatisch ermittelt und es wird geprüft ob der dazwischenliegende Knoten mit einem weiteren Strömungslement verbunden ist. In diesem Fall wäre die Regelung nicht mehr anwendbar und es wird ein Fehler ausgegeben. 

Der Regler `TemperatureDifferenceOfFollowingElement` kann nur für die Modelle `ControlledValve` und `ControlledPump` verwendet werden.


### Regler: TemperatureDifferenceOfFollowingElement

Mit diesem Regler wird ein Ventil implementiert, welches die Temperaturdifferenz des nächsten Strömungselements (in Verknüpfungsreihenfolge) regelt. Das nächste Strömungselement wird automatisch ermittelt und es wird geprüft ob der dazwischenliegende Knoten mit einem weiteren Strömungslement verbunden ist. In diesem Fall wäre die Regelung nicht mehr anwendbar und es wird ein Fehler ausgegeben. 


### Regler: ThermostatValue

Der Regler `ThermostatValue` kann nur für das Modell `SimplePipe` verwendet werden.

### Regler: MassFlux

Mit diesem Regler wird der Massenstrom des Strömungselements geregelt. Der Regler `MassFlux` kann nur für die Modelle `ControlledValve` und `ControlledPump` verwendet werden.

### Parameter für die Regler-Logik

Reglersollwerte

[options="header",cols="22%,^ 10%,38%, ^ 30%",width="100%"]
|====================
|Name | Einheit | Beschreibung |  Verwendung mit `ControlledProperty`

| `TemperatureDifferenceSetpoint` | C | Sollwert der Temperaturdifferenz |  `TemperatureDifference`, `TemperatureDifferenceOfFollowingElement` 

| `MassFluxSetpoint` | kg/s | Sollwert des Massenstroms |  `MassFlux` 
|====================

Reglerparameter

[options="header",cols="22%,^ 10%,38%, ^ 30%",width="100%"]
|====================
|Name | Einheit | Beschreibung |  Verwendung mit `ControllerType`
| `Kp` | --- | Verstärkung des Reglers | `PController`, `PIController` 
| `Ki` | --- | Integralwert des Reglers | `PIController` 
|====================



## Ausgaben

Die Ergebnisgrößen eines thermo-hydraulischen Netzwerkmodells werden wie folgt definiert. Als Referenzierungstyp dient entweder `Network` für Ausgaben des Netzwerks insgesamt, oder `NetworkElement` für die Adressierung individueller Strömungselemente (siehe <<ex_objectList_networks>>).

[[ex_objectList_networks]]
.Objektlist für die Referenzierung eines Netzwerks mit der ID 1 und ausgewählter Elemente des Netzwerks
====
[source,xml]
----
<ObjectLists>
	<ObjectList name="the Network">
		<FilterID>1</FilterID> <!-- ID of network -->
		<ReferenceType>Network</ReferenceType>
	</ObjectList>
	<ObjectList name="Pipes">
		<FilterID>1,3</FilterID> <!-- IDs of flow elements -->
		<ReferenceType>NetworkElement</ReferenceType>
	</ObjectList>
</ObjectLists>
----
====


### Verfügbare Ausgaben

Die Ausgaben der thermo-hydraulischen Netzwerkberechnung werden je nach Referenzierungstyp in eigenen Dateien mit dem Namensschema:

- `network_<gridname>.tsv` (für Ausgaben mit Referenztyp `Network`)
- `network_elements_<gridname>.tsv` (für Ausgaben mit Referenztyp `NetworkElement`)

angelegt. Wie bei regulären Ausgaben (siehe <<output_filenames>>) wird der Suffix `_<gridname>` weggelassen, wenn es nur eine Ausgabedatei mit einem Ausgaberaster gibt.

Für die Analyse der Netzwerke und Übergabesysteme sind sowohl die Masseströme und Temperaturen im Inneren eines Verbindungselementes, aber auch an den Verbindungsstellen zwischen zwei Elementen von Interesse. Letzerer Fall ist beispielsweise typisch für gekoppelte Erzeuger- und Verbraucherkreisläufe, wobei eine Kontrolle der Zulauf- und Rücklauftemperatur möglich sein muss. 

Da die Netzwerkvisualisierungsebene keine Knoten kennt, müssen Knotentemperaturen am Ein- und Auslass des Verbindungselementes abgegriffen werden. Ein- und Auslässe sind unabhängig von der Strömungsrichtung entsprechend der Netzwerktopologie definiert. 

[NOTE]
====
Es wird bei der Topologiedefinition eines Netzwerks mittels der `HydraulicNetworkElement` Elements von einer nominalen Strömungsrichtung ausgegangen. Deshalb werden Einlass- und Auslassknoten mittels der IDs `inletNodeId` und `outletNodeId` referenziert. 

Je nach Bedingungen im Netzwerk ist es jedoch auch möglich, dass sich die Strömungsrichtung umkehrt, und das Medium nun auf der Einströmseite eines Rohres ausströmt. Dies wirkt sich zwar im Vorzeichen des Massestroms aus, jedoch nicht in der Bezeichung der nur von der Einbaurichtung abhängigen Ein- und Auslässe eines Strömungselements.
====

[TIP]
====
Möchte man alle Knotendrücke oder Knotentemperaturen erhalten, so kann man einfach von allen Strömungselementen die Drücke am Auslass erfragen. Darüber erhält man dann alle Drücke an den jeweiligen Knoten.
====


### Ausgaben der rein hydraulischen Netzwerkberechnung

Für jedes Strömungselement kann ein Massenstrom ausgegeben werden, wobei die Strömungsrichtung immer von _inletNode_ zu _outletNode_ positiv definiert ist. Der Massenstrom kann über die Größe `FluidMassFlux` (in kg/s) abgefragt werden (Referenztyp `NetworkElement`).

Ebenso sind für jedes Strömungselement die Drücke am Ein- und Auslass abrufbar: 

- `InletNodePressure` in Pa
- `OutletNodePressure` in Pa


### Ausgaben der thermo-hydraulischen Berechnung

Jedes Strömungselement hat eine (mittlere) Temperatur, welche über die Ausgabegröße `FluidTemperature` abgefragt werden kann (Referenztyp `NetworkElement`).

[NOTE]
====
Die mittlere Temperatur einen Strömungselements kann zur Visualisierung/Farbgebung des Elements verwendet werden.
====

[CAUTION]
====
Je nach physikalischer Modellierung eines Strömungselements muss die Mitteltemperatur einen Strömungselements nicht mit der Auslasstemperatur übereinstimmen (siehe Modelldokumentation). Beispiele dafür sind Speicher oder lange verlustbehaftete Rohre.
====

Die Temperaturen am Ein- bzw. Auslass sind (wie die Drücke) an den physischen Positionen _inletNode_ und _outletNode_ definiert und können ausgegeben werden. Es sind beispielsweise folgende Ausgabevariablen für den Referenztyp `NetworkElement` definiert:

- `InletNodeTemperature` in C
- `OutletNodeTemperature` in C
- `FlowElementHeatLoss` in W - Wärmestrom abgegeben vom Strömungselement (Energie wird dem Fluid in diesem Element entzogen). Positive Werte bedeuten Abkühlen des Mediums (Wärmeverlust).

[TIP]
====
Die Auswahl einzelner Elemente via ID kann über Objektlisten recht flexibel erfolgen.
====

Je nach verwendetem Strömungselement sind individuelle zusätzliche Ausgabegrößen abrufbar (siehe Dokumentation der Strömungselemente).

### Ausgaben des Netzwerks

Es gibt seitens des Netzwerks selbst auch Variablen, welche für ein gesamtes Netzwerk abgerufen werden können (Referenztyp `Network`):

- `FluidMassFluxes` - Masseströme [kg/s] durch alle Strömungselemente des Netzwerks
- `ActiveLayerThermalLoad` - Wärmestrom [W] in beheizte Schichten einer Konstruktion
- `NetworkZoneThermalLoad` - Wärmestrom [W] in eine Zone

Diese Variablen sind vektor-wertige Größen und es muss die __Id__ des jeweils angeforderten Vektorelements verwendet werden. <<ex_network_outputs>> zeigt die Definition einer ID-basierten Ausgabe für Massenströme des Netzwerks.

[[ex_network_outputs]]
.Beispiel für Ausgabedefinitionen mit Network als Referenztyp
====
[source,xml]
----
<!-- Outputs go to file 'network.tsv' -->
<OutputDefinition>
	<!-- We choose the flow through the second element 
	     (pipe 101) as reference flux for the entire network -->
	<Quantity>FluidMassFluxes[id=101]</Quantity>
	<ObjectListName>Entire network</ObjectListName>
	<GridName>hourly</GridName>
</OutputDefinition>
----
====


:xrefstyle: basic

