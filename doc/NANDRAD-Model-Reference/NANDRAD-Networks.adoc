:imagesdir: ./images

[[networks]]
# HydraulicNetworks

Dieser Abschnitt beschreibt die Parametrisierung von thermo-hydraulischen Netzwerken.

In einer Projektdatei kann es mehrere Netzwerke geben. Diese sind im XML tag `HydraulicNetworks` abgelegt.

.Hydraulische Netzwerke
====
[source,xml]
----
<HydraulicNetworks>
	<HydraulicNetwork id="1" displayName="xxx">
        ... <!-- network parameters -->
	</HydraulicNetwork>

	<HydraulicNetwork id="2" displayName="yyy">
        ... <!-- network parameters -->
	</HydraulicNetwork>

    ... <!-- other networks -->
	
</HydraulicNetworks>
----
====

[IMPORTANT]
====
Die einzelnen Netzwerke sind hydraulisch unabhängig, d.h. es gibt keinen Fluidaustausch zwischen Netzwerken. Die Netzwerke können aber thermisch verknüpft sein, z.B. kann ein Quartierswärmenetz mit einem Gebäudeanlagennetz Wärme austauschen. Dies bedingt auch _eindeutige ID_ der in _allen_ Netzwerken definierten hydraulischen Netzwerkkomponenten.
====



## Definition eines hydraulischen Netzwerks

Ein einzelnes Netzwerk wird im XML-tag `HydraulicNetwork` definiert, wie im folgenden Beispiel:

.Typische Definition eines einzelnen Netzwerks
====
[source,xml]
----
<HydraulicNetwork id="1" displayName="Simple network" modelType="ThermoHydraulicNetwork">
	<HydraulicFluid id="1" displayName="Water">
        ... <!-- fluid parameters -->
    </HydraulicFluid>
    
	<PipeProperties>
        ... <!-- database with pipe definitions -->
	</PipeProperties>
	
	<Components>
        ... <!-- database with component definitions -->
	</Components>
	
	<Elements>
        ... <!-- network flow elements with topology definition -->
	</Elements>
	
</HydraulicNetwork>
----
====

XML-tag `HydraulicNetwork` hat folgende Attribute:

.Attributes
[options="header",cols="20%,40%,^ 10%,^ 30%",width="100%"]
|====================
| Attribute  | Description | Format | Usage 
| `id` |  Unique identifier of the network | {nbsp}>{nbsp}0{nbsp}  | _required_
| `displayName`  |  Display name of the network. | string | _optional_
| `modelType`  |  Specifies a particular network calculation mode. | string | _optional_ 
 (defaults to `ThermalHydraulicNetwork`)
|====================

:xrefstyle: short

Das optionale Attribut `modelType` beschreibt, welches Berechnungsmodell zu verwenden ist (<<tab_network_modelType>>):

[[tab_network_modelType]]
.Werte für Attribut `modelType`
[options="header",cols="30%,70%",width="100%"]
|====================
| Attribute  | Description  
| `HydraulicNetwork` |  Only the hydraulic network calculation is done, i.e. mass flux and pressure calculation.
| `ThermoHydraulicNetwork`  |  Network is calculated with thermal balances enabled. Each flow element corresponds to at least one energy/enthalpy balance equation.
|====================

Die Wahl des Netzwerkberechnungsmodells hat Auswirkungen auf die benötigte Parametrisierung der beteiligten Komponenten.

### Parameter

Je nach Modelltyp können mehrere globale Netzwerkparameter definiert werden. 

[options="header",cols="30%,^ 10%, 30%,^ 10%,^ 20%",width="100%"]
|====================
|Name|Unit|Description|Value Range |Usage
| `DefaultFluidTemperature` | C | einheitliche, konstante Fluidtemperatur zur Verwendung mit einem rein hydraulischen Modell | {nbsp}>{nbsp}0.0{nbsp} | _required for model type_  `HydraulicNetwork`
| `InitialFluidTemperature` | C | Anfangsfluidtemperatur | {nbsp}>{nbsp}0.0{nbsp} | _required for model type_ `ThermoHydraulicNetwork`
|====================

Innerhalb des Netzwerk-Definitionsblocks gibt es vier Kind-Elemente.

## Medieneigenschaften

Der XML-tag `HydraulicFluid` enthält die Definition des im Netzwerk strömenden Mediums. 

[IMPORTANT]
====
In jedem Netzwerk gibt es nur ein einziges Fluid, und deshalb ist auch nur eine einzige Instanz des `HydraulicFluid` Tags erlaubt.
====

.Definition eines Netzwerkfluids
====
[source,xml]
----
<HydraulicFluid id="1" displayName="Water">
	<IBK:Parameter name="Density" unit="kg/m3">998</IBK:Parameter>
	<IBK:Parameter name="HeatCapacity" unit="J/kgK">4180</IBK:Parameter>
	<IBK:Parameter name="Conductivity" unit="W/mK">0.6</IBK:Parameter>
	<LinearSplineParameter name="KinematicViscosity" interpolationMethod="linear">
		<X unit="C">0 10 20 30 40 50 60 70 80 </X>
		<Y unit="m2/s">1.793e-06 1.307e-06 1.004e-06 8.01e-07 6.58e-07 5.54e-07 4.75e-07 4.13e-07 3.65e-07 </Y>
	</LinearSplineParameter>
</HydraulicFluid>
----
====

XML-tag `HydraulicFluid` hat folgende Attribute:

.Attributes
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribute  | Description | Format | Usage 
| `id` |  Unique identifier of the fluid | {nbsp}>{nbsp}0{nbsp}  | _required_
| `displayName`  |  Display name of the network | string | _optional_
|====================

[NOTE]
====
Da es nur eine Fluid-Definition per Netzwerk geben darf, ist das _id_ Attribut eigentlich überflüssig. Es wird lediglich zur Aktualisierung der Programmdatenbank beim Import eines Projekts benötigt.
====

:xrefstyle: basic

Parameter des Netzwerkfluids (see section <<IBK_Parameter>> for a description of the `IBK:Parameter` tag):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name|Unit|Description|Value Range |Usage
| `Density` | kg/m3 | Dichte bei Referenztemperatur | {nbsp}>{nbsp}0.0{nbsp} | _required_
| `HeatCapacity` | J/kgK | Spezifische Wärmekapazität | {nbsp}>{nbsp}0.0{nbsp} | _required_
| `Conductivity` | W/mK | Wärmeleitfähigkeit bei Referenztemperatur | {nbsp}>={nbsp}0.0{nbsp} | _required_
|====================

[NOTE]
====
Die obigen Eigenschaften, insbesondere die Dichte, werden zur Vereinfachung als temperaturunabhänig konstant angenommen. Für die meisten Anwendungsfälle der thermo-hydraulischen Simulation im Gebäude-/Quartierskontext wird die thermische Ausdehnung des Fluids nicht benötigt. Und die Auslegung des Ausdehngefäßes erfolgt nicht mit der Simulation.
====

Desweiteren gibt es noch temperaturabhängige Parameter, welche in linear interpolierten Datentabellen abgelegt werden (siehe Abschnitt <<LinearSplineParameter>> für eine Beschreibung des  `LinearSplineParameter` Elements):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name|Unit|Description|Value Range |Usage
| `KinematicViscosity` | m2/s | Kinematische Viscosität | {nbsp}>{nbsp}0.0{nbsp} | _required_
|====================


## Rohreigenschaften

Die Rohreigenschaften `HydraulicNetworkPipeProperties` legen die physikalische/geometrischen Eigenschaften eines Rohrtyps fest. Diese werden in dem Katalog `PipeProperties` mit eindeutigen IDs aufgelistet. 

.Definition von Rohreigenschaften
====
[source,xml]
----
<PipeProperties>
	<HydraulicNetworkPipeProperties id="1">
		<IBK:Parameter name="PipeRoughness" unit="m">0.007</IBK:Parameter>
		<IBK:Parameter name="PipeInnerDiameter" unit="mm">25.6</IBK:Parameter>
		<IBK:Parameter name="PipeOuterDiameter" unit="mm">32</IBK:Parameter>
		<IBK:Parameter name="UValuePipeWall" unit="W/m2K">5</IBK:Parameter>
	</HydraulicNetworkPipeProperties>
	
	...
</PipeProperties>
----
====

Wenn ein `HydraulicNetworkElement` ein Rohr repräsentiert, können ihm über den den XML-tag `pipePropertyId` entsprechende  `HydraulicNetworkPipeProperties` zugewiesen werden. 

.Attributes
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribute  | Description | Format | Usage 
| `id` |  Unique identifier of the pipe properties | {nbsp}>{nbsp}0{nbsp}  | _required_
|====================

Parameter der Rohreigenschaftem (see section <<IBK_Parameter>> for a description of the `IBK:Parameter` tag):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
|Name|Unit|Description|Value Range |Usage
| `PipeRoughness` | mm | Roughness of pipe wall | {nbsp}>{nbsp}0.0{nbsp}  | _required_
| `PipeInnerDiameter` | mm | Inner diameter of pipe | {nbsp}>{nbsp}0.0{nbsp}  | _required_
| `PipeOuterDiameter` | mm | Outer diameter of pipe | {nbsp}>{nbsp}0.0{nbsp}  | _required_
|_(*)_ `UValuePipeWall` | W/m2K | U-Value of pipe wall (including insulation) | {nbsp}>{nbsp}0.0{nbsp}  | _required_ 
|====================

_(*) - not yet used_

[[component_definition]]
## Komponentendefinitionen

Eine `HydraulicNetworkComponent` definiert die Basiseigenschaften eines Strömungselements. Diese werden in dem Katalog `Components` mit eindeutigen IDs aufgelistet.

.Definition einer Komponente
====
[source,xml]
----
<Components>
    <HydraulicNetworkComponent id="1" modelType="ConstantPressurePump">
    	<IBK:Parameter name="PressureHead" unit="Pa">1000</IBK:Parameter>
    	<IBK:Parameter name="Volume" unit="m3">0.01</IBK:Parameter>
    </HydraulicNetworkComponent>
    
    ...
</Components>
----
====

.Attributes
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribute  | Description | Format | Usage 
| `id` |  Unique identifier of the component | {nbsp}>{nbsp}0{nbsp}  | _required_
| `modelType` |  Type of component  | string | _required_
|====================


Die Parameter und Attribute sind dann abhängig vom `modelType` der Komponente und dem `modelType` des Netzwerks.

### StaticAdiabaticPipe

Für das Model `StaticAdiabaticPipe` werden keine weiteren Parameter benötigt.


### ConstantPressurePump

Für das Model `ConstantPressurePump` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name|Unit|Description|Value Range | Usage 
| `PressureHead` | Pa | Constant pressure added by the pump | any | 
| _(*)_ `PumpEfficiency` | - | Hydraulic efficiency of pump | 0...1,{nbsp}>{nbsp}0.0 | only `ThermalHydraulicNetwork`
| _(*)_ `MotorEfficiency` | - | Efficiency of motor | 0...1,{nbsp}>{nbsp}0.0 | only `ThermalHydraulicNetwork`
| _(*)_ `Volume` | m3 | Fluid volume inside the pump | {nbsp}>{nbsp}0.0{nbsp} | only `ThermalHydraulicNetwork`
|====================

_(*) - not yet used_

### HeatExchanger

Für das Model `HeatExchanger` werden diese Parameter benötigt:

[options="header",cols="22%,^ 10%,38%,^ 12%, ^ 18%",width="100%"]
|====================
|Name|Unit|Description|Value Range | Usage 
| `HydraulicDiameter` | mm | equivalent hydraulic diameter (needed to compute flow cross section and flow velocity) | {nbsp}>{nbsp}0.0{nbsp} | _required_
| `PressureLossCoefficient` | --- | effective pressure loss coefficient | {nbsp}>{nbsp}0.0{nbsp} | _required_
| _(*)_ `Volume` | m3 | Fluid volume inside the heat exchanger | {nbsp}>{nbsp}0.0{nbsp} | only `ThermalHydraulicNetwork`
|====================

_(*) - not yet used_


[[HydraulicNetworkElement]]
## Strömungselemente

.Definition der verknüpften Strömungselemente (Knotennummerierung erfolgt implizit)
====
[source,xml]
----
<Elements>
	<HydraulicNetworkElement id="1" inletNodeId="5" outletNodeId="6" componentId="1">
		<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
		<IBK:Parameter name="Temperature" unit="C">10</IBK:Parameter>
	</HydraulicNetworkElement>
	<HydraulicNetworkElement id="2" inletNodeId="6" outletNodeId="7" componentId="2">
		<IBK:Parameter name="HeatFlux" unit="W">100</IBK:Parameter>
	</HydraulicNetworkElement>
	...
</Elements>
----
====

Die tatsächlichen Strömungselemente des Netzwerks werden innerhalb des XML-tags `Elements` mit dem XML-tag `HydraulicNetworkElement` definiert. Diese haben die folgenden Attribute:

.Attributes
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribute  | Description | Format | Usage 
| `id` |  Unique ID of the `HydraulicNetworkElement` | {nbsp}>{nbsp}0{nbsp}  | _required_
| `inletNodeId` |  Unique ID of inlet node  | {nbsp}>{nbsp}0{nbsp}  | _required_
| `outletNodeId` |  Unique ID of outlet node  | {nbsp}>{nbsp}0{nbsp}  | _required_
| `componentId` |  Unique ID of referenced `HydraulicNetworkComponent`  | {nbsp}>{nbsp}0{nbsp}  | _required_
| `pipePropertiesId` |  Unique ID of referenced `HydraulicNetworkPipeProperties` | {nbsp}>{nbsp}0{nbsp}  | optional (_required_ for pipes)
| `displayName`  |  Display name of the element (used for error/informative messages) | string | optional
|====================

[IMPORTANT]
====
Die ID eines `HydraulicNetworkElement` muss global eindeutig sein, d.h. Strömungselemente müssen netzwerkübergreifend mit einer eindeutigen ID bezeichnet werden.
====

:xrefstyle: short

[[fig_network_example1]]
.Einfaches Strömungsnetzwerk mit 3 Knoten und 3 Elementen
image::network_example.png[pdfwidth=8cm]

Die Strömungselemente sind miteinander durch Knoten verknüpft. In jedem Strömungselement fließt das Fluid von dem Knoten mit der `inletNodeId` zu dem Knoten mit der `outletNodeId`. <<fig_network_example1>> zeigt ein einfaches Netzwerk bestehend aus 3 Elementen.  Ein solches Netzwerk würde wie folgt definiert werden (<<ex_network_example1>>).

[[ex_network_example1]]
.XML-Definition eines einfachen Strömungsnetzwerks mit 3 Knoten und 3 Elementen
====
[source,xml]
----
<Elements>
    <!-- Pump -->
	<HydraulicNetworkElement id="1" inletNodeId="1" outletNodeId="2" componentId="1"/>
	<!-- Pipe id=2-->
	<HydraulicNetworkElement id="2" inletNodeId="2" outletNodeId="3" componentId="2">
		<IBK:Parameter name="Length" unit="m">10</IBK:Parameter>
	</HydraulicNetworkElement>
	<!-- Pipe id=3-->
    <HydraulicNetworkElement id="3" inletNodeId="3" outletNodeId="1" componentId="2">
		<IBK:Parameter name="Length" unit="m">6</IBK:Parameter>
	</HydraulicNetworkElement>
</Elements>
----
====


[NOTE]
====
Verschiedene Strömungselemente sind durch die Knoten IDs `inletNodeId` und `outletNodeId` verknüpft. Die Knoten-IDs referenzieren keine Strömungselemente, sondern "virtuelle" Knoten.
====

Jedes Strömungselement referenziert jeweils eine Komponente mit der `componentId`. 


### Rohr-Elemente

Ist eine Komponente ein Rohr (z.B. `DynamicPipe`), **müssen** entsprechende Rohrparameter mit der `pipePropertiesId` referenziert werden. 

:xrefstyle: short

Weiterhin **muss** für ein Rohrelement der Parameter `Length` definiert werden (siehe auch <<ex_pipe_element>>):

[options="header",cols="18%,^ 15%,38%,^ 20%, ^ 10%",width="100%"]
|====================
|Name|Unit|Description|Value Range | Usage 
| `Length` | m | Length of pipe | {nbsp}>{nbsp}0.0{nbsp} | _optional_
|====================

[[ex_pipe_element]]
.Definition eines Rohrelements
====
[source,xml]
----
<HydraulicNetworkElement id="2" inletNodeId="0" outletNodeId="1" componentId="3" pipePropertiesId="1">
	<IBK:Parameter name="Length" unit="m">100</IBK:Parameter>
</HydraulicNetworkElement>
----
====



## Ausgaben

Die Ergebnisgrößen eines thermo-hydraulischen Netzwerkmodells werden wie folgt definiert. Als Referenzierungstyp dient entweder `Network` für Ausgaben des Netzwerks insgesamt, oder `NetworkElement` für die Adressierung individueller Strömungselemente (siehe <<ex_objectList_networks>>).

[[ex_objectList_networks]]
.Objektlist für die Referenzierung eines Netzwerks mit der ID 1 und ausgewählter Elemente des Netzwerks
====
[source,xml]
----
<ObjectLists>
	<ObjectList name="the Network">
		<FilterID>1</FilterID> <!-- ID of network -->
		<ReferenceType>Network</ReferenceType>
	</ObjectList>
	<ObjectList name="Pipes">
		<FilterID>1,3</FilterID> <!-- IDs of flow elements -->
		<ReferenceType>NetworkElement</ReferenceType>
	</ObjectList>
</ObjectLists>
----
====

### Verfügbare Ausgaben

Das Netzwerk-Objekt liefert eine Vielzahl von Ergebnisgrößen für die einzelnen Strömungselemente.

Die Anforderungen an die Netzwerkausgaben richten sich allerdings nach der späteren Visualisierungsebene. Grundlegend ist davon auszugehen, dass im Postprozessing eine weitere Sicht erforderlich sein wird, welche neben dem Gebäude eine Auswertung der hydraulischen Netzwerke erlaubt. Um die Übersichtlichkeit zu wahren, wird diese Sicht von derjenigen des Gebäudes getrennt sein. 

Die Netzwerkausgaben werden daher räumlich getrennt in eigenen Dateien mit dem Namensschema:

- `network_<gridname>.tsv` (für Ausgaben mit Referenztyp `Network`)
- `network_elements_<gridname>.tsv` (für Ausgaben mit Referenztyp `NetworkElement`)

angelegt. Wie bei regulären Ausgaben (siehe <<output_filenames>>) wird der Suffix `_<gridname>` weggelassen, wenn es nur eine Ausgabedatei mit einem Ausgaberaster gibt.

Für Analyse der Netzwerke und Übergabesysteme sind sowohl die Masseströme und Temperaturen im Innere eines Verbindungselementes, aber auch an den Verbindungsstellen zwischen zwei Elementen von Interesse. Letzerer Fall ist beispielsweise typisch für gekoppelte Erzeuger- und Verbraucherkreisläufe, wobei eine Kontrolle der Zulauf- und Rücklauftemperatur möglich sein muss. 

Da die Netzwerkvisualisierungsebene keine Knoten kennt, müssen Knotentemperaturen am Ein- und Auslass des Verbindungselementes abgegriffen werden. Ein- und Auslässe sind unabhängig von der Strömungsrichtung entsprechend der Netzwerktopologie definiert. 

[NOTE]
====
Es wird bei der Topologiedefinition eines Netzwerks mittels der `HydraulicNetworkElement` tags von einer nominalen Strömungsrichtung ausgegangen. Deshalb werden Einlass- und Auslassknoten mittels der IDs `inletNodeId` und `outletNodeId` referenziert. 

Je nach Bedingungen im Netzwerk ist es jedoch auch möglich, dass sich die Strömungsrichtung umkehrt, und das Medium nun auf der Einströmseite eines Rohres ausströmt. Dies wirkt sich zwar im Vorzeichen des Massestroms aus, jedoch nicht in der Bezeichung der _geometrischen_ Ein- und Auslässe eines Strömungselements.
====

[TIP]
====
Mächte man alle Knotendrücke oder Knotentemperaturen erhalten, so kann man einfach von allen Strömungselementen die Drück am Auslass erfragen. Darüber erhält man dann alle Drücke an den jeweiligen Knoten.
====

#### Ausgaben der hydraulischen Netzwerkberechnung

Für jedes Strömungselement kann ein Massestrom ausgegen werden, wobei die Strömungsrichtung immer von _inletNode_ zu _outletNode_ positiv definiert ist. Der Massestrom kann über die Größe `FluidMassFlux` (in kg/s) abgefragt werden (Referenztyp `NetworkElement`).

Ebenso sind für jedes Strömungselement die Drücke am Ein- und Auslass abrufbar: 

- `InletNodePressure` in Pa
- `OutletNodePressure` in Pa


#### Ausgaben der thermo-hydraulischen Berechnung

Jedes Strömungselement hat eine (mittlere) Temperatur, welche über die Ausgabegröße `FluidTemperature` abgefragt werden kann (Referenztyp `NetworkElement`).

[NOTE]
====
Die mittlere Temperatur einen Strömungselements kann zur Visualisierung/Farbgebung des Elements verwendet werden.
====

[CAUTION]
====
Je nach physikalischer Modellierung eines Strömungselements muss die Mitteltemperatur einen Strömungselements nicht mit der Auslasstemperatur übereinstimmen (siehe Modelldokumentation). Beispiele dafür sind Speicher oder lange verlustbehaftete Rohre.
====

#### Ausgaben des Netzwerks

Zur Vereinfachung dienen die Variablennamen `FluidTemperatures` und `FluidMassFluxes`, welche für ein gesamtes Netzwerk abgerufen werden können (Referenztyp `Network`). Diese enthalten jeweils Ausgaben für alle Strömungselemente.


### Variablennamen in Ausgabedateien

Variablen für Ausgaben vom Referenztyp `NetworkElement` werden in den Ausgabedateien wie folgt angegeben: `NetworkElement(id=1).FluidMassFlux` wobei hier `id=1` die ID des ausgewählten Netzwerkelements.



TODO : document Network results once they work



:xrefstyle: basic

