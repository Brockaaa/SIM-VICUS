:imagesdir: ./images
[[climatic_loads]]
# Klimalasten

## Übersicht

Klimalasten werden in NANDRAD über Klimadateien bereitgestellt. Für die Berechnung der Sonneneinstrahlung werden Informationen über den Gebäudestandort (in der Regel in der Klimadatei enthalten) sowie die Ausrichtung und Neigung der verschiedenen Konstruktionsflächen (definiert für Außenflächen, siehe <<construction_instances,Geometry/Constructions>>) benötigt.

## Spezifikation

Informationen über Standort- und Klimadaten werden im Abschnitt `Location` der Projektdatei gespeichert:

.Definition des Standorts
====
[source,xml]
----
<Location>
	<IBK:Parameter name="Latitude" unit="Deg">51</IBK:Parameter>
	<IBK:Parameter name="Longitude" unit="Deg">13</IBK:Parameter>
	<IBK:Parameter name="Albedo" unit="---">0.2</IBK:Parameter>
	<IBK:Parameter name="Altitude" unit="m">100</IBK:Parameter>
	<IBK:Flag name="PerezDiffuseRadiationModel">false</IBK:Flag>
	<ClimateFileName>${Projektverzeichnis}/climate/GER_Potsdam_2017.c6b</ClimateFileName>
</Location>
----
====

Parameter (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des tags `IBK:Parameter`):

[options="header",cols="18%,^ 15%,38%,^ 20%,10%",width="100%"]
|====================
|Name|Einheit|Beschreibung|Wertebereich |Verwendung
|`Albedo`|---|Wird für die Berechnung der diffusen Sonneneinstrahlung verwendet (siehe <<loads_solar_radiation>>)| 0...1 |_erforderlich_
|`Altitude`|m|wird für bestimmte höhenbezogene Parameter benötigt (**TODO**)| >0 | _optional_
|`Longitude`|Deg|Wenn angegeben, wird der Ortsparameter `Longitude` der Klimadatendatei überschrieben (siehe <<location_settings>>).|-180...180|_optional_
|`Latitude`|Deg|Wenn angegeben, wird der Ortsparameter `Latitude` der Klimadatendatei überschrieben (siehe <<location_settings>>).|-90...90|_optional_
|====================

Flags und Optionen (siehe Abschnitt <<IBK_Flag>> für eine Beschreibung des tags `IBK:Flag`):

[options="header",cols="15%,65%,10%,10%",width="100%"]
|====================
| Name | Beschreibung | Standard | Verwendung 
| `PerezDiffuseRadiationModel` | Legt fest, ob das Perez-Modell für die Berechnung der diffusen Sonnenstrahlung verwendet werden soll | _false_ | _optional_
|====================

Schließlich definiert das tag `<ClimateFileName>` den Pfad zur Klimadatei.

[[loads_climate_files]]
### Klimadateien

Derzeit werden `c6b`, `wac` und `epw` Dateien unterstützt (siehe auch Hilfe zum Werkzeug https://bauklimatik-dresden.de/ccmeditor/help[CCM-Editor]).

Sie müssen den Pfad zur Klimadatei im `<ClimateFileName>`-tag angeben. Dabei können Sie einen absoluten oder relativen Pfad angeben.

Wenn ein relativer Pfad angegeben wird, wird dieser mit dem aktuellen Arbeitsverzeichnis als Referenz aufgelöst. Wenn Sie zum Beispiel angegeben haben 

[source,xml]
----
<KlimaDateiname>GER_Potsdam_2017.c6b</KlimaDateiname>
----

und der Solver aus dem Verzeichnis `/home/user/sim/Project1` gestartet wird, wird die Klimadatendatei in `/home/user/sim/Project1/GER_Potsdam_2017.c6b` gesucht. Wenn der Solver von einem anderen Verzeichnis aus gestartet wird, wird die referenzierte Klimadatendatei nicht gefunden und es wird eine Fehlermeldung ausgegeben.

Um dieses Problem zu vermeiden, können Sie Verzeichnisplatzhalter angeben, um die Klimadatendatei _relativ_ zum Speicherort der Projektdatei zu finden. Der eingebaute Pfadplatzhalter `${Project Directory}` wird durch das Verzeichnis ersetzt, in dem sich die Projektdatei befindet. Verwenden Sie den Platzhalter einfach wie einen regulären Verzeichnisteil, z. B:

[source,xml]
----
<KlimaDateiname>${Project Directory}/Klima /GER_Potsdam_2017.c6b</KlimaDateiname>
----

Es ist möglich, für alle extern referenzierten Dateien eigene Platzhalter im Projekt zu definieren, siehe <<path_placeholders>>.


[[location_settings]]
### Gebäude-/Stationsstandort

Klimadatendateien enthalten Informationen über Breiten- und Längengrad der Wetterstation, die auch als Standort des Gebäudes angenommen wird. Dadurch wird sichergestellt, dass simulierte Zeit und Sonnenstand übereinstimmen.

Es ist möglich, Breitengrad/Längengrad in der Projektdatei zu definieren. Wenn diese Parameter in der Projektdatei angegeben werden, müssen immer **beide** Parameter angegeben werden (und gültig sein), dann werden diese Parameter aus der Projektdatei anstelle der Standortparameter der Klimadatei verwendet.
[VORSICHT]
====
Durch die Angabe eines von der Klimastation abweichenden Breitengrades kann der berechnete Sonnenstand nicht mehr mit dem Sonnenstand an der Wetterstation übereinstimmen, was zu möglicherweise falschen Solarstrahlungslasten führt.
====

Gültiger Wertebereich für `Latitude` ist [-90,90] Grad (positive Werte entsprechen der nördlichen Hemisphäre), für `Longitude` ist es [-180,180] Grad (positive Werte sind östlich von Greenwich).


### Zyklische (jährliche) und kontinuierliche (mehrjährige) Klimadaten

Die Klimadaten-Datei kann 8760 Stundenwerte für ein ganzes Jahr enthalten. Alles andere wird als beliebiger Bereich von Zeitwerten betrachtet, der ein bestimmtes Zeitintervall angibt, eventuell auch mit variierenden Zeitabständen zwischen den Datenpunkten. Die letztgenannten Klimadateien können nicht für die jährliche/zyklische Berechnung verwendet werden, sondern benötigen ein bestimmtes (passendes) Simulationszeitintervall (siehe auch Abschnitt <<simulation_interval>>).


#### Zyklisches Jahresklima

Die Klimadaten werden in Stundenwerten bereitgestellt. Die Interpretation dieser Werte hängt von der Art der Größe ab. NANDRAD unterscheidet zwischen Zustandsgrößen und Fluß-/Lastgrößen.

Zustandsgrößen sind:

- Temperaturen
- relative Luftfeuchten
- Luftdrücke
- Windrichtung
- Windgeschwindigkeit

Fluss-/Lastgrößen sind:

- direkte Sonnenstrahlungsintensität (in Normalrichtung der Sonne)
- diffuse solare Strahlungsintensität (in horizontaler Ebene)
- Regenlast
- langwellige Himmelsemission

:xrefstyle: short

Es wird erwartet, dass die Zustandsgrößen als _instantielle Werte_ am __Ende jeder Stunde__ überwacht werden. Substündliche Werte werden durch lineare Interpolation erhalten, wie in <<fig_hourly_values>> gezeigt.

[[fig_hourly_values]]
.lineare Interpolation verwenden, um sub-stündliche Werte aus stündlichen Datenpunkten zu rekonstruieren
image::CCM_Interpolation1.png[]

Fluss-/Lastgrößen werden als _Mittelwerte_ über die __letzte Stunde__ erwartet. Die substündlichen Werte werden durch lineare Interpolation zwischen den in der Mitte jeder Stunde platzierten Mittelwerten erhalten, wie in <<fig_hourly_load_values>> gezeigt.

[[fig_hourly_load_values]]
.mit linearer Interpolation zur Rekonstruktion von substündlichen Werten aus stündlichen Mittelwerten
image::CCM_Interpolation2.png[]

:xrefstyle: basic



#### Kontinuierliche Daten

Die Klimadatendatei enthält Datenpunkte (mindestens 2), die den frühesten Start- und spätesten Endpunkt der Simulation markieren.

[NOTE]
====
Wenn Sie die Simulation über die verfügbaren Klimadaten hinaus fortsetzen, werden die letzten Werte im Klimadatensatz konstant gehalten. Dies führt letztendlich zu sinnlosen Ergebnissen (es sei denn, dies ist in künstlichen Testfällen beabsichtigt).
====

Da der Benutzer in den Klimadatendateien beliebige Zeitschritte bis hin zu winzigen Werten wählen kann, hängt die Genauigkeit der Eingabedaten von den Benutzereingaben ab. Zwischen den Zeitpunkten wird der Solver *alle Größen* in der Klimadatendatei linear interpolieren und nicht wie bei stündlichen Daten zwischen Zuständen und Lasten unterscheiden.

[TIP]
====
Um das gleiche Ergebnis wie bei jährlichen Stundendaten zu erzielen, müssen Klimadaten in 30-Minuten-Intervallen angegeben und interpolierte Werte am Ende und in der Mitte jeder Stunde selbst berechnet werden.
====


[[location_sensors]]
### Zusätzliche Strahlungssensoren

Es ist möglich zusätzliche Ebenen (Sensoren) zu spezifizieren, um Lastausgänge für die Sonneneinstrahlung zu erzeugen. Dies geschieht durch die Angabe einer `Sensor`-Definition.

.Definition eines Sensors am Standort
====
[source,xml]
----
<Location>
    ....
    <Sensors>
		<!-- Flachdach>
		<Sensor id="1">
			<IBK:Parameter name="Orientation" unit="Deg">0</IBK:Parameter>
			<IBK:Parameter name="Inclination" unit="Deg">0</IBK:Parameter>
		</Sensor>
		<!-- Nordwand 90 -->
		<Sensor id="2">
			<IBK:Parameter name="Orientation" unit="Deg">0</IBK:Parameter>
			<IBK:Parameter name="Inclination" unit="Deg">90</IBK:Parameter>
		</Sensor>
        ...
    </Sensors>
</Location>
----
====
.Attribute
[options="header",cols="20%,60%,^ 10%,^ 10%",width="100%"]
|====================
| Attribut | Beschreibung | Format | Verwendung 
| `id` | Kennung des Sensors | {nbsp}>{nbsp}0{nbsp} | _erforderlich_
|====================


Parameter (siehe Abschnitt <<IBK_Parameter>> für eine Beschreibung des tags `IBK:Parameter`):

[options="header",cols="18%,^ 15%,38%,^ 20%,^ 10%",width="100%"]
|====================
| Name | Einheit | Beschreibung | Wertebereich | Verwendung 
| `Orientation` | Deg | Ausrichtung des Sensors | 0...360 | _erforderlich_ 
| `Inclination` | Deg a| Neigung des Sensors

* 0 Deg - nach oben gerichtet
* 90 Grad - z. B. wie eine senkrechte Wand
* 180 Grad - nach unten gerichtet

 | 0...180 | _erforderlich_
|====================

Einem Sensor muss eine eindeutige ID-Nummer und die obligatorischen Parameter `Orientation` und `Inclination` gegeben werden (siehe Abschnitt <<construction_instances,Construction Instances>> für Details zu deren Definition).

Für jeden Sensor werden 4 Ausgangsgrößen erzeugt:

* `DirectSWRadOnPlane[<sensor id>]` - direkte Sonnenstrahlungsintensität auf der Ebene in [W/m2]
* `DiffuseSWRadOnPlane[<sensor id>]` - diffuse Sonnenstrahlungsintensität auf der Ebene in [W/m2]
* `GlobalSWRadOnPlane[<sensor id>]` - globale Strahlungsintensität auf der Ebene in [W/m2] (die Summe der beiden erstgenannten Größen)
* `IncidenceAngleOnPlane[<sensor id>]` - der Einfallswinkel auf die Ebene in [Grad] (0°, wenn der Sonnenstrahl senkrecht zur Ebene steht, 90°, wenn der Strahl parallel zur Ebene steht oder wenn die Sonne unter dem Horizont ist)

Beispiel für einen Sensorausgang (siehe auch Ausgangsbeschreibung im Abschnitt <<outputs>>).

[source,xml]
----
<OutputDefinitionen>
    ...
    <!-- direkte Strahlung intensiv vom Sensor mit id=2 -->
	<OutputDefinition>
		<Quantity>DirektSWRadOnPlane[2]</Quantity> 
		<ObjectListName>Ort</ObjectListName>
		<GridName>minütlich</GridName>
	</OutputDefinition>
	<!-- Einfallswinkel vom Sensor mit id=42 -->
	<OutputDefinition>
		<Quantity>IncidenceAngleOnPlane[42]</Quantity>
		<ObjectListName>Ort</ObjectListName>
		<GridName>Minütlich</GridName>
	</OutputDefinition>
    ...
</OutputDefinitions>
----

[[loads_solar_radiation]]
## Sonnenstrahlungsberechnung

Die Berechnung der Sonneneinstrahlung folgt den in der __Physikalischen Modellreferenz__ aufgeführten Gleichungen. Der Parameter `Albedo` wird bei der Berechnung der diffusen Strahlungslast verwendet.


[[precomputed_shading]]
## Vorberechnete Schattierung

:xrefstyle: short

Eine vorverarbeitende Software kann für jedes Flächenelement des Gebäudes den prozentualen Anteil der Fläche mit Sonneneinstrahlung berechnen. In <<fig_shading_factors>> wird zum Beispiel eine Fassade teilweise verschattet.

[[fig_shading_factors]]
.Darstellung einer teilverschatteten Fassade mit einem Fenster
image::SolarShading.png[pdfwidth=12cm]

Die Software kann nun den Prozentsatz der verschatteten Fläche sowohl für das opake Fassadenelement als auch für das eingebettete Fensterobjekt separat berechnen. Das Fenster ist zu ca. 80 % verschattet, und ca. 20 % der Fläche sind noch der Sonne ausgesetzt. Der Faktor, der für diese Zeit und die Fensterfläche gespeichert wird beträgt 0,2.

Der für eine Konstruktion gespeicherte Faktor beinhaltet immer auch eventuell eingebettete Objekte.  <<fig_shading_factor_example>> zeigt ein ähnliches Bild, jedoch einfacher zu berechnen.

[[fig_shading_factor_example]]
.Berechnungsbeispiel für eine teilverschattete Fassade mit einem Fenster
image::SolarShading_example.png[pdfwidth=12cm]

Die Konstruktion hat eine Fläche von 18x8 = 144 m2. Das Fenster hat eine Fläche von 10x4 = 40 m2.
Der Schatten auf der Konstruktion nimmt 13x8 = 104 m2 ein, daher ist der Schattenanteil (Faktor) für die Konstruktion: 104/144 = 72,2 %.

Der Schatten auf dem Fenster allein nimmt (13-(18-10)/2)x4 = 9x4 = 36 m2 ein. Der Verschattungsflächenfaktor für das Fenster allein beträgt also 90%.

Die Werte *72,2%* und *90%* werden in der Datei für die schattierten Flächenanteile gespeichert.


Die schattierte Fläche auf der opaken Fläche beträgt 104 - 36 = 68 m2.  Die opake Konstruktion an sich hat eine Fläche von 144 - 40 = 104 m2. Der Abminderungsfaktor, der in der Gleichung für die Belastung durch die Sonneneinstrahlung verwendet werden muss beträgt also 68/104 = 65,4 %. Diese Berechnung wird intern durch das Solarstrahlungsmodell durchgeführt.

[IMPORTANT]
====
Denken Sie daran, den prozentualen Anteil der verschatteten Fläche für Konstruktionen *immer einschließlich aller eingebetteten Objekte* zu berechnen.
====

:xrefstyle: basic

### Dateiformat für vorberechnete schattierte Fraktionen

Die Datei mit den vorberechneten Schattierungsfaktoren wird im XML-tag `Location` referenziert, als Child-tag 
`ShadingFactorFileName`. Der hier angegebene Pfad kann ein absoluter Pfad oder ein relativer Pfad sein, der dem Platzhalter `${Project Directory}` folgt (siehe <<path_placeholders>>).

Die Datei folgt den Regeln des `tsv`-Dateiformats (siehe _PostProc 2_ Dokumentation) und hat eine einzelne Kopfzeile. Die erste Spalte ist die Zeitspalte, mit entweder absoluten Zeitstempeln oder Zeit-offsets relativ zu Mitternacht des 1. Januar des Startjahres.

Alle anderen Spalten enthalten die berechneten Bruchwerte für die schattierteten Flächen, wobei jeder Spaltenkopf die jeweilige Fläche mit einer ID-Zeichenkette identifiziert.

Die ID-Zeichenkette folgt dem Muster: `<objID>.<ID-number>`. Objekt-IDs sind entweder `conInst` oder `embObj`.

Bei der Berechnung werden die Werte in der Datentabelle linear interpoliert.


