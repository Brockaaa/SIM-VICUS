# Network Test Cases



## Hydraulic Tests

### HydraulicNetwork.nandrad

- Einzelner Kreis, 4 Komponenten, siehe `HydraulicNetwork.pdf`
- Referenzelement ist 201 (die Pumpe), d.h. Referenzdruck von 0 Pa
  liegt am Einlauf der Pumpe an
- Druckabfall in Strömungsrichtung, jeweils nach dem Strömungselement:

```
  201 (Pumpe)         : 1000.0 Pa  (node 2)
  101 (Rohr 1)        :  515.4 Pa  (node 3)
  301 (Wärmetauscher) :  484.6 Pa  (node 4)
  102 (Rohr 2)        :    0.0 Pa  (node 1)
```
- Konstanter Massenstrom:  0.0570898 kg/s


### HydraulicNetworkInvertedPump.nandrad

- wie `HydraulicNetwork.nandrad`
- Pumpe entgegengesetzt eingebaut
- Massestrom sollte anderes Vorzeichen haben
- Druckverteilung sollte entsprechend anders herum abnehmen
- Druckabfall, ausgegeben am "Outlet" (beachte, Outlet der Pumpe ist an 
  Node 1, und Outlet of 102 ist auch an Node 1)

```
  201 (Pumpe)         : 1000.0 Pa   (node 1)
  102 (Rohr 2)        : 1000.0 Pa   (node 1)
  301 (Wärmetauscher) :  515.4 Pa   (node 4)
  101 (Rohr 1)        :  484.6 Pa   (node 3)
```
- Konstanter Massenstrom:  -0.0570908 kg/s


### HydraulicNetworkZeroPump.nandrad

- wie `HydraulicNetwork.nandrad`
- aber Triviallösungstests, Pumpe mit dp = 0 pa


### HydraulicNetworkSplitter.nandrad

- Zwei Kreise (parallele Rohre), siehe `HydraulicNetworkSplitter.pdf`
- Dadurch, dass das Rohr 103 einen deutlich höheren Strömungswiderstand hat,
  fließt dort weniger Fluid durch.
- Masseströme durch Rohre 103 und 105 summieren sich zum Massestrom durch Pumpe und
  Rohre 107, 101 und 102  

```
  103 (Rohr)         : 0.0174 kg/s
  105 (Rohr)         : 0.0694 kg/s (wie auch 104 und 106)
  107 (Rohr)         : 0.0868 kg/s (wie auch 101, 102, und Pumpe 201)
```


### HydraulicNetworkBackFlow.nandrad

- Zwei Kreise, zwei Pumpen (eine dezentral), siehe `HydraulicNetworkBackFlow.pdf`
- kleine Pumpe (202) erzeugt lokal einen Druckanstieg, der die Strömungsrichtung 
  in Rohr 103 umkehrt.
  
```
  103 (Rohr)         : -0.0354 kg/s
  105 (Rohr)         :  0.0968 kg/s (wie auch 104 und 106)
  107 (Rohr)         :  0.0614 kg/s (wie auch 101, 102, und Pumpe 201)
```

- In diesem Beispiel zirkuliert ein Teil des Fluids immer nur im oberen Kreis.



## Thermo-Hydraulic Tests - Milestone 1


### ThermoHydraulicNetworkSimplePipeAdiabat.nandrad

Einfaches Modell mit nur einer Pumpe mit Wirkungsgrad 100% und einem adiabaten Rohr.

- Pumpe (1001) mit 100% Wirkungsgrad
- Rohr (1002), Modell SimplePipe, adiabat

Ergebnis:
FluidTemperature und OutletNodeTemperature von 1001 und 1002
```
20.0°C
```
FluidMassFlux von 1001 und 1002
```
0.0478246 kg/s
```

### ThermoHydraulicNetworkPumpWithLosses.nandrad

Fast identisch mit ThermoHydraulicNetworkSimplePipeAdiabat, jetzt hat die Pumpe aber einen Wirkungsrad von 40%.

Der abgegebene Wärmestrom berechnet sich zu  

```
Q_heatloss = (1-0.4) / 0.4 * dp * m_dot / rho = (1-0.4)/ 0.4 * 10000 * 0.0818862 / 998 = 1.23075 W
```

und stimmt mit der Wärmeabgabe der Pumpe überein.
```
NetworkElement(id=1001).FlowElementHeatLoss [W] = 
-1.23076
```

Die OutletNodeTemperature steigt linear an und beträgt nach 24 h Simulationszeit 
```
NetworkElement(id=1001).OutletNodeTemperature [C] =
20.4893
```




### ThermoHydraulicNetworkHeatExchangerHeatFluxConst.nandrad

Einfacher Kreis, 2 Elemente:

- Pumpe (1001)
- HeatExchanger (1003) mit konstantem Wärmestrom

Der Wärmestom beträgt -50 W. Entsprechend:
```
Zeit [h]	NetworkElement(id=1003).FlowElementHeatLoss [W]
0	-50
1	-50
```

Ergebnis: Die Fluidtemperatur steigt auf 41.58°C:
```
Zeit [h]	NetworkElement(id=1003).OutletNodeTemperature [C]
0	20
1	41.5834
```

Fluidvolumen im Netzwerk bekannt, da Dichte und spezifische Wärmekapazität bekannt ist,
kann Temperaturerhöhung nach einer Stunde analytisch berechnet werden.

TODO : Hauke

```

V = 
rho = 998
ct = 4180

dT = 

```



### ThermoHydraulicNetworkConstantHeatloss_Dense.nandrad

Ein Kreis, 3 Elemente:

- Pumpe 201 (`ConstantPressurePump`), Wirkungsgrad 100%
- Wärmetauscher 301, Wärmeaustauschmodell `HeatFluxConstant`, 500 W konstante Energiequelle
- Rohr 101 (`SimplePipe`), Wärmeaustauschmodell `TemperatureConstant`, 
  Erdreichtemperatur 0 C

Abkühlung des Systems von einer einheitlichen Fluidtemperatur von 20 C
- Anfänglich erwärmt der Wärmetauscher das Fluid in der Pumpe etwas, bis 
  sich das im Rohr abgekühlte Fluid auswirkt
- nach Einlaufen in den stationären Zustand (ca. 40 h), gibt es eine analytische Lösung

500 W = Wärmeverlust im Rohr, bei einer Temperaturspreizung von:

```
  T_in    = 3.3263 C
  T_out   = 1.2272 C
  dT      = 2.0991 K
  
  mdot     = 0.0569877 kg/s
  cTFluid  = 4180 J/kgK
```

Bilanz über Vor- und Rücklauf des Rohres ist:  
```
  Q_heatloss = 2.0991 * 0.0569877 * 4180 J/kgK  = 500.0236428726 W
```

Der Wärmeverlust im Rohr kommt durch Wärmeübertragung zur 0 C kalten Außenseite
zu stande. Für alle Temperaturen in der Berechnung (Viskosität, 
Temperaturdifferenz zur Außenseite) wird die Rohrmitteltemperatur = T_out verwendet.

```
   dT = 1.2272 K

   din         = 0.00256 m
   length      = 100 m
   fluidVolume = 0.05147 m3   = din*din * Pi/4 * length
   fluidDensity = 998 kg/m3
   
   velocity = 0.001109 m/s = mdot/(volume*density)
   viscosity = 1.793e-6   (konstant)
   
   reynolds = 15.84
   prandtl = 12.466
   nusselt = 1

   fluidConductivity = 0.6
   innerHeatTransferCoefficient = 23.4375 = nusselt * fluidConductivity/din
   outerHeatTransferCoefficient =  5
   UValuePipeWall               =  5

   UValueTotal                  = 4.0744
   
   UAValueTotal                 = 407.4392 W/K = UValueTotal * length

   m_heatLoss                   = 500.2 W 
```

### ThermoHydraulicNetworkConstantHeatloss_KLU.nandrad

- exakt gleich wie `ThermoHydraulicNetworkConstantHeatloss_Dense.nandrad`, 
  aber mit KLU als direktem Gleichungssystemlöser
- Testfall prüft, ob bei der KLU die Besetzung der Matrix korrekt bestimmt wurde

```
                             Dense      KLU
WallClockTime                0.014948   0.015597
FrameworkTimeWriteOutputs    0.015563   0.017207
FrameworkTimeStepCompleted   3.00E-06   4.00E-06
IntegratorSteps              94         94
IntegratorErrorTestFails     2          2
IntegratorNonLinearConvFails 0          0
IntegratorFunctionEvals      109        109
IntegratorTimeFunctionEvals  0.00014    0.000141
IntegratorLESSetup           19         19
IntegratorTimeLESSetup       8.00E-06   2.40E-05
IntegratorLESSolve           108        108
IntegratorTimeLESSolve       1.20E-05   1.30E-05
LESSetups                    19         19
LESJacEvals                  2          2
LESTimeJacEvals              3.00E-06   6.00E-06
LESRHSEvals                  8          6
LESTimeRHSEvals              4.00E-06   1.00E-06
```

Identische Counter!


### ThermoHydraulicNetworkSerialPipes.nandrad

Zwei unterschiedliche Rohre in einem Kreis zusammen mit Pumpe und Wärmetauscher (konstant 2000 W Wärmeabgabe). Rohre geben Wärme an konstant temperiertes Erdreich ab.


### ThermoHydraulicNetworkParallelPipes.nandrad

- Test Plausibilität Wärmeabgabe und Druckverlust durch unterschiiedlich parametrierte Rohre im stationären Zustand
- 2 parallele Rohre mit unterschiedlicher Dimension (Rohr 2 hat doppelte Länge und doppelten Durchmesser)
- 2 Pumpen mit angespasster Druckdifferenz (Pumpe 1 liefert die vierfache Druckdifferenz)
- Konstante Außentemperatur
- Konstanter Leistungsverlust im Netzwerk, provisorisch abgebildet durch Wärmetauscher mit Wärmeverlust und geringem Druckverlustbeiwert

**Erwartungshaltung**: doppelter Massestrom und doppelter Wärmeverlust durch Rohr 2, identische Fluidaustrittstemperaturen für beide Rohrstränge. Die Summe der Rohrwärmeverluste muss der aufgenommenen Wärmemenge (Wärmestrom) im Wärmetauscher entsprechen und somit die thermische Bilanz im Netzwerk erhalten.


### ThermoHydraulicNetworkStaticFlowParallelPipesMixer.nandrad

- 2 parallele Kreise, Rohre mit unterschiedlichen Masseströmen, wie `ThermoHydraulicNetworkParallelPipes.nandrad` (Rohr 2 hat doppelt so viel Massestrom wie Rohr 1)
- unterschiedliche Umgebungstemperaturen für beide Rohre
- beim Mixer-Knoten muss die Mischtemperatur richtig berechnet werden

**Erwartung**: Das Rohr mit der geringeren Umgebungstemperatur gibt diesselbe Wärme ab, welche das Rohr mit der wärmeren Umgebungstemperatur aufnimmt. Die Temperaturspreizung zwischen Fluidtemperatur und Außentemperatur im Rohr ist beim größeren Rohr (Rohr 2) doppelt so hoch wie beim kleineren (Rohr 1), allerdings mit umgekehrtem Vorzeichen. 




## Thermo-Hydraulic Tests - Milestone 2

### ThermoHydraulicNetworkSimplePipeTemperatureDataFile.nandrad

2 Elemente:

- Pumpe (1001) mit 100% Wirkungsgrad
- Rohr (1002), Modell SimplePipe, Wärmeaustausch mit zeitlichem Temperaturverlauf, gegeben in einer tsv-Datei

Der Temperaturverlauf in der tsv-Datei ist
```
Time[h]	Temperature[C]
0	0
12	0
20	20.0
```

Die Austrittstemperatur des Rohrs bei t=0 h 
```
NetworkElement(id=1002).OutletNodeTemperature [C]
20
```

Die Austrittstemperatur des Rohrs bei t=12 h 
```
NetworkElement(id=1002).OutletNodeTemperature [C]
-6.77998e-07
```

Die Austrittstemperatur des Rohrs bei t=24 h 
```
NetworkElement(id=1002).OutletNodeTemperature [C]
20.0001
```

### ThermoHydraulicNetworkHeatExchangerHeatFluxDataFile.nandrad

Wie ThermoHydraulicNetworkHeatExchangerHeatFluxConst, nur mit einem zeitabhängigen Wärmestrom, gegeben in der tsv-Datei:
```
Time[h]	Flux[W]
0	0
1	-50
2	0
```

Der Wärmestrom stimmt mit der Wärmeabgabe des Wärmetauschers überein
```
Zeit [h]	NetworkElement(id=1003).FlowElementHeatLoss [W]
0	0
1	-50
2	0
```






