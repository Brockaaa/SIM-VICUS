# Network Test Cases



## Hydraulic Tests

### HydraulicNetworkStatic.nandrad

- Einzelner Kreis, 4 Komponenten, siehe `Network.pdf`
- Referenzelement ist 201 (die Pumpe), d.h. Referenzdruck von 0 Pa
  liegt am Einlauf der Pumpe an
- Druckabfall in Strömungsrichtung, jeweils nach dem Strömungselement:

```
  201 (Pumpe)         : 1000.0 Pa  (node 2)
  101 (Rohr 1)        :  515.4 Pa  (node 3)
  301 (Wärmetauscher) :  484.6 Pa  (node 4)
  102 (Rohr 2)        :    0.0 Pa  (node 1)
```
- Konstanter Massenstrom:  0.0570898 kg/s


### HydraulicNetworkStaticInvertedPump.nandrad

- wie `HydraulicNetworkStatic.nandrad`
- Pumpe entgegengesetzt eingebaut
- Massestrom sollte anderes Vorzeichen haben
- Druckverteilung sollte entsprechend anders herum abnehmen
- Druckabfall, ausgegeben am "Outlet" (beachte, Outlet der Pumpe ist an 
  Node 1, und Outlet of 102 ist auch an Node 1)

```
  201 (Pumpe)         : 1000.0 Pa   (node 1)
  102 (Rohr 2)        : 1000.0 Pa   (node 1)
  301 (Wärmetauscher) :  515.4 Pa   (node 4)
  101 (Rohr 1)        :  484.6 Pa   (node 3)
```
- Konstanter Massenstrom:  -0.0570908 kg/s


### HydraulicNetworkSplitter.nandrad

- Zwei Kreise (parallele Rohre), siehe `NetworkWithSplitter.pdf`
- Dadurch, dass das Rohr 103 einen deutlich höheren Strömungswiderstand hat,
  fließt dort weniger Fluid durch.
- Masseströme durch Rohre 103 und 105 summieren sich zum Massestrom durch Pumpe und
  Rohre 107, 101 und 102  

```
  103 (Rohr)         : 0.0174 kg/s
  105 (Rohr)         : 0.0694 kg/s (wie auch 104 und 106)
  107 (Rohr)         : 0.0868 kg/s (wie auch 101, 102, und Pumpe 201)
```


### HydraulicNetworkStaticBackFlow.nandrad

- Zwei Kreise, zwei Pumpen (eine dezentral), siehe `NetworkWithBackFlow.pdf`
- kleine Pumpe (202) erzeugt lokal einen Druckanstieg, der die Strömungsrichtung 
  in Rohr 103 umkehrt.
  
```
  103 (Rohr)         : -0.0354 kg/s
  105 (Rohr)         :  0.0968 kg/s (wie auch 104 und 106)
  107 (Rohr)         :  0.0614 kg/s (wie auch 101, 102, und Pumpe 201)
```

- In diesem Beispiel zirkuliert ein Teil des Fluids immer nur im oberen Kreis.



## Thermo-Hydraulic Tests


### ThermoHydraulicNetworkSimplePipeAdiabat.nandrad

Einfaches Modell mit nur einer Pumpe mit Wirkungsgrad 100% und einem adiabaten Rohr.

- Pumpe (1001) mit 100% Wirkungsgrad
- Rohr (1002), Modell SimplePipe, adiabat

Ergebnis:
Alle Temperaturen bleiben konstant bei 20°C.


### ThermoHydraulicNetworkPumpWithLosses.nandrad

Fast identisch mit ThermoHydraulicNetworkSimplePipeAdiabat, jetzt hat die Pumpe aber einen Wirkungsrad von 40%.

Die meachnische Leistung ist

```
W = dp  m_dot/rho = 10000   



### ThermoHydraulicNetworkStaticFlowConstantHeatloss_Dense.nandrad

Ein Kreis, 3 Elemente:

- Pumpe 201 (`ConstantPressurePump`), Wirkungsgrad 100%
- Wärmetauscher 301, Wärmeaustauschmodell `HeatFluxConstant`, 500 W konstante Energiequelle
- Rohr 101 (`SimplePipe`), Wärmeaustauschmodell `TemperatureConstant`, 
  Erdreichtemperatur 0 C

Abkühlung des Systems von einer einheitlichen Fluidtemperatur von 20 C
- Anfänglich erwärmt der Wärmetauscher das Fluid in der Pumpe etwas, bis 
  sich das im Rohr abgekühlte Fluid auswirkt
- nach Einlaufen in den stationären Zustand (ca. 40 h), gibt es eine analytische Lösung

500 W = Wärmeverlust im Rohr, bei einer Temperaturspreizung von:

```
  T_in    = 3.3263 C
  T_out   = 1.2272 C
  dT      = 2.0991 K
  
  mdot     = 0.0569877 kg/s
  cTFluid  = 4180 J/kgK
```

Bilanz über Vor- und Rücklauf des Rohres ist:  
```
  Q_heatloss = 2.0991 * 0.0569877 * 4180 J/kgK  = 500.0236428726 W
```

Der Wärmeverlust im Rohr kommt durch Wärmeübertragung zur 0 C kalten Außenseite
zu stande. Für alle Temperaturen in der Berechnung (Viskosität, 
Temperaturdifferenz zur Außenseite) wird die Rohrmitteltemperatur = T_out verwendet.

```
   dT = 1.2272 K

   din         = 0.00256 m
   length      = 100 m
   fluidVolume = 0.05147 m3   = din*din * Pi/4 * length
   fluidDensity = 998 kg/m3
   
   velocity = 0.001109 m/s = mdot/(volume*density)
   viscosity = 1.793e-6   (konstant)
   
   reynolds = 15.84
   prandtl = 12.466
   nusselt = 1

   fluidConductivity = 0.6
   innerHeatTransferCoefficient = 23.4375 = nusselt * fluidConductivity/din
   outerHeatTransferCoefficient =  5
   UValuePipeWall               =  5

   UValueTotal                  = 4.0744
   
   UAValueTotal                 = 407.4392 W/K = UValueTotal * length

   m_heatLoss                   = 500.2 W 
```

### ThermoHydraulicNetworkStaticFlowConstantHeatloss_KLU.nandrad

- exakt gleich wie `ThermoHydraulicNetworkStaticFlowConstantHeatloss_Dense.nandrad`, 
  aber mit KLU als direktem Gleichungssystemlöser
- Testfall prüft, ob bei der KLU die Besetzung der Matrix korrekt bestimmt wurde

```
                             Dense      KLU
WallClockTime                0.014948   0.015597
FrameworkTimeWriteOutputs    0.015563   0.017207
FrameworkTimeStepCompleted   3.00E-06   4.00E-06
IntegratorSteps              94         94
IntegratorErrorTestFails     2          2
IntegratorNonLinearConvFails 0          0
IntegratorFunctionEvals      109        109
IntegratorTimeFunctionEvals  0.00014    0.000141
IntegratorLESSetup           19         19
IntegratorTimeLESSetup       8.00E-06   2.40E-05
IntegratorLESSolve           108        108
IntegratorTimeLESSolve       1.20E-05   1.30E-05
LESSetups                    19         19
LESJacEvals                  2          2
LESTimeJacEvals              3.00E-06   6.00E-06
LESRHSEvals                  8          6
LESTimeRHSEvals              4.00E-06   1.00E-06
```

Identische Counter!











